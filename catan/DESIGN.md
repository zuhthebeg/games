# 카탄 (Catan) 게임 설계 문서

## 개요
- 3~4인 멀티플레이어 전략 보드게임
- 자원 수집, 건설, 거래를 통해 10점 먼저 달성하면 승리
- 반응형 디자인 (모바일/PC)

## 게임 컴포넌트

### 1. 맵 구조
```
        [hex] [hex] [hex]
      [hex] [hex] [hex] [hex]
    [hex] [hex] [hex] [hex] [hex]
      [hex] [hex] [hex] [hex]
        [hex] [hex] [hex]
```
- 19개 육각형 타일 (3-4-5-4-3 배열)
- 각 타일: 자원 종류 + 주사위 숫자(2-12, 7 제외)

### 2. 자원 타일 (19개)
| 자원 | 개수 | 색상 |
|------|------|------|
| 벽돌 (Brick) | 3 | 🟤 갈색 |
| 나무 (Lumber) | 4 | 🟢 초록 |
| 양모 (Wool) | 4 | 🟡 연두 |
| 밀 (Grain) | 4 | 🟠 노랑 |
| 광석 (Ore) | 3 | ⚫ 회색 |
| 사막 (Desert) | 1 | 🏜️ 베이지 |

### 3. 숫자 토큰 (18개)
- 2, 12: 각 1개
- 3, 4, 5, 6, 8, 9, 10, 11: 각 2개
- 6, 8: 빨간색 (확률 높음)
- 사막에는 숫자 없음

### 4. 정점 (Vertices) - 54개
- 마을/도시 건설 위치
- 각 정점은 최대 3개 헥스와 인접

### 5. 변 (Edges) - 72개
- 도로 건설 위치
- 각 변은 2개 정점 연결

### 6. 건물 비용
| 건물 | 비용 | 점수 |
|------|------|------|
| 도로 | 벽돌1 + 나무1 | 0 |
| 마을 | 벽돌1 + 나무1 + 양모1 + 밀1 | 1 |
| 도시 | 밀2 + 광석3 | 2 (마을→도시) |
| 개발카드 | 양모1 + 밀1 + 광석1 | ? |

### 7. 개발 카드 (25장)
| 카드 | 개수 | 효과 |
|------|------|------|
| 기사 (Knight) | 14 | 도둑 이동 + 카드 훔치기 |
| 승점 (VP) | 5 | +1점 (즉시) |
| 도로 건설 | 2 | 무료 도로 2개 |
| 발명 | 2 | 원하는 자원 2개 획득 |
| 독점 | 2 | 한 종류 자원 모두 가져오기 |

### 8. 특수 점수
- 최장 도로 (5개 이상 연속): +2점
- 최대 기사단 (3명 이상 기사): +2점

### 9. 항구 (Ports) - 9개
- 일반 항구 (4개): 3:1 교환
- 전문 항구 (5개): 해당 자원 2:1 교환

## 게임 진행

### Phase 1: 초기 배치
1. 플레이어 순서 결정 (랜덤)
2. 순서대로 마을1 + 도로1 배치
3. 역순으로 마을1 + 도로1 배치
4. 두 번째 마을 인접 헥스에서 자원 1개씩 획득

### Phase 2: 메인 게임 (턴 진행)
1. **주사위 굴리기**
   - 해당 숫자 헥스에 마을/도시 있으면 자원 획득
   - 마을: 1개, 도시: 2개
   - 7 나오면 → 도둑 활성화

2. **도둑 (7 굴렸을 때)**
   - 8장 초과 소유자: 절반 버림
   - 도둑을 다른 헥스로 이동
   - 해당 헥스 인접 플레이어에게 카드 1장 훔치기
   - 도둑 있는 헥스는 자원 생산 안함

3. **거래**
   - 플레이어간 자유 거래
   - 은행과 4:1 교환 (기본)
   - 항구 이용시 3:1 또는 2:1

4. **건설**
   - 도로: 기존 도로/마을에 연결
   - 마을: 도로에 연결 + 다른 마을과 2칸 이상 거리
   - 도시: 기존 마을 업그레이드
   - 개발카드: 구매 (이번 턴에 사용 불가)

5. **개발카드 사용**
   - 턴당 1장만 사용 가능
   - 구매한 턴에는 사용 불가

### Phase 3: 승리 조건
- 자기 턴에 10점 이상 달성
- 점수 = 마을(1) + 도시(2) + 승점카드 + 최장도로(2) + 최대기사(2)

## 기술 설계

### 서버 (GamePlugin)
```typescript
interface CatanState {
  // 맵
  hexes: Hex[];           // 19개 타일
  vertices: Vertex[];     // 54개 정점
  edges: Edge[];          // 72개 변
  ports: Port[];          // 9개 항구
  robber: number;         // 도둑 위치 (hex index)
  
  // 플레이어
  players: CatanPlayer[];
  currentPlayer: number;
  turnPhase: 'setup1' | 'setup2' | 'roll' | 'main' | 'robber' | 'discard';
  
  // 카드
  devCardDeck: DevCard[];
  
  // 특수 보너스
  longestRoad: string | null;    // player id
  largestArmy: string | null;    // player id
  
  // 거래
  pendingTrade: Trade | null;
}

interface CatanPlayer {
  id: string;
  nickname: string;
  color: string;
  resources: Resources;
  devCards: DevCard[];
  usedKnights: number;
  victoryPoints: number;
}
```

### 클라이언트 (UI)
1. **헥스 그리드 렌더링**
   - CSS Grid + clip-path 또는 SVG
   - 클릭 가능한 정점/변 표시

2. **반응형 레이아웃**
   - 모바일: 세로 스크롤, 터치 확대
   - PC: 전체 맵 한눈에

3. **UI 컴포넌트**
   - 맵 뷰 (중앙)
   - 내 자원/카드 (하단)
   - 다른 플레이어 상태 (상단/측면)
   - 거래 창 (모달)
   - 건설 메뉴

## 파일 구조
```
games/catan/
├── index.html      # 메인 게임
├── icon.svg        # 아이콘
└── catan.js        # 게임 로직 (클라이언트)

games-server/functions/games/
└── catan.ts        # 서버 플러그인
```

## 구현 순서
1. [x] 설계 문서
2. [ ] 서버 플러그인 (catan.ts)
   - 맵 생성 로직
   - 게임 상태 관리
   - 액션 검증/처리
3. [ ] 클라이언트 기본 UI
   - 헥스 그리드 렌더링
   - 정점/변 클릭
4. [ ] 초기 배치 Phase
5. [ ] 메인 게임 Phase
6. [ ] 거래 시스템
7. [ ] 개발 카드
8. [ ] 최장도로/최대기사 계산
9. [ ] 반응형 최적화
10. [ ] 테스트 및 버그 수정
