<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>포커 로그라이크 - 블라인드 러시</title>
  <link rel="icon" href="icon.svg" type="image/svg+xml">
  <style>
    :root {
      color-scheme: dark light;
      --bg: #0b1118;
      --panel: #131c27;
      --panel-2: #1a2633;
      --text: #f2f7ff;
      --muted: #9fb0c2;
      --accent: #32d6b0;
      --danger: #ff667a;
      --good: #89f07a;
      --gold: #ffd76b;
      --border: #2b3b4f;
      --card-bg: #f4f7fb;
      --card-text: #0c1824;
      --heart: #e43f5a;
      --diamond: #ff6f59;
      --club: #253748;
      --spade: #102234;
      --chip-shadow: 0 10px 26px rgba(0, 0, 0, 0.35);
      --bg-ornament: radial-gradient(1200px 800px at 10% -10%, rgba(50, 214, 176, 0.18), transparent 60%), radial-gradient(1200px 800px at 100% 0%, rgba(255, 215, 107, 0.1), transparent 58%), linear-gradient(180deg, #0a1018 0%, #0e1520 100%);
    }

    :root.light {
      color-scheme: light;
      --bg: #edf2f8;
      --panel: #ffffff;
      --panel-2: #f7fbff;
      --text: #0f1c2b;
      --muted: #5a6d82;
      --accent: #007d71;
      --danger: #cb1f4d;
      --good: #208149;
      --gold: #bc7f00;
      --border: #d9e4ef;
      --card-bg: #ffffff;
      --card-text: #0f1c2b;
      --chip-shadow: 0 10px 20px rgba(16, 34, 52, 0.14);
      --bg-ornament: radial-gradient(1000px 700px at 20% -10%, rgba(0, 125, 113, 0.1), transparent 65%), radial-gradient(900px 600px at 100% 0%, rgba(188, 127, 0, 0.09), transparent 62%), linear-gradient(180deg, #ebf2fb 0%, #e6eef8 100%);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      min-height: 100vh;
      font-family: "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
      background: var(--bg-ornament);
      color: var(--text);
      padding: 12px;
    }

    .app {
      max-width: 1080px;
      margin: 0 auto;
      display: grid;
      gap: 12px;
      grid-template-columns: 1.2fr 1fr;
    }

    .topbar,
    .panel {
      background: linear-gradient(165deg, var(--panel), var(--panel-2));
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: var(--chip-shadow);
    }

    .topbar {
      grid-column: 1 / -1;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
    }

    .title {
      font-size: 1.1rem;
      font-weight: 800;
      letter-spacing: 0.01em;
    }

    .subtitle {
      color: var(--muted);
      font-size: 0.88rem;
    }

    .row {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    button {
      border: 1px solid var(--border);
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.03);
      color: var(--text);
      padding: 9px 12px;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.15s ease, background 0.15s ease;
    }

    button:hover:enabled {
      transform: translateY(-1px);
      background: rgba(255, 255, 255, 0.08);
    }

    button:disabled {
      opacity: 0.45;
      cursor: not-allowed;
    }

    .btn-main {
      border-color: transparent;
      background: linear-gradient(90deg, var(--accent), #37a5ff);
      color: #061420;
    }

    .btn-warn {
      border-color: transparent;
      background: linear-gradient(90deg, #ff8a65, #ffb74d);
      color: #2c1400;
    }

    .panel {
      padding: 12px;
    }

    .status-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(120px, 1fr));
      gap: 8px;
    }

    .stat {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.02);
    }

    .stat .k {
      color: var(--muted);
      font-size: 0.8rem;
      margin-bottom: 4px;
    }

    .stat .v {
      font-size: 1.05rem;
      font-weight: 800;
    }

    .blind {
      color: var(--gold);
    }

    .score {
      color: var(--good);
    }

    .table {
      position: relative;
      min-height: 360px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      gap: 12px;
    }

    .cards-wrap {
      display: grid;
      grid-template-columns: repeat(4, minmax(62px, 1fr));
      gap: 8px;
    }

    .card {
      border-radius: 12px;
      background: var(--card-bg);
      border: 2px solid #c6d2df;
      color: var(--card-text);
      min-height: 90px;
      padding: 8px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      flex-direction: column;
      user-select: none;
      cursor: pointer;
      transition: transform 0.16s ease, box-shadow 0.16s ease, border-color 0.16s ease;
      animation: dealIn 0.22s ease;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 7px 18px rgba(0, 0, 0, 0.2);
    }

    .card.selected {
      transform: translateY(-7px);
      border-color: var(--accent);
      box-shadow: 0 10px 20px rgba(50, 214, 176, 0.28);
    }

    .rank {
      font-size: 1.05rem;
      font-weight: 900;
    }

    .suit {
      align-self: flex-end;
      font-size: 1.25rem;
      line-height: 1;
      font-weight: 900;
    }

    .s-heart { color: var(--heart); }
    .s-diamond { color: var(--diamond); }
    .s-club { color: var(--club); }
    .s-spade { color: var(--spade); }

    .actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .info-line {
      color: var(--muted);
      font-size: 0.9rem;
      min-height: 1.35em;
    }

    .hand-tag {
      font-weight: 800;
      color: var(--gold);
    }

    .joker-area {
      display: grid;
      grid-template-columns: repeat(5, minmax(84px, 1fr));
      gap: 8px;
    }

    .joker {
      border-radius: 10px;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,0.07), rgba(255,255,255,0.01));
      min-height: 115px;
      padding: 8px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      gap: 4px;
      font-size: 0.78rem;
    }

    .joker.empty {
      opacity: 0.35;
      justify-content: center;
      align-items: center;
      color: var(--muted);
    }

    .joker .name {
      font-size: 0.85rem;
      font-weight: 800;
      color: var(--gold);
    }

    .log {
      max-height: 180px;
      overflow: auto;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.84rem;
      color: var(--muted);
      padding-right: 4px;
    }

    .fx {
      position: absolute;
      right: 10px;
      top: 12px;
      background: rgba(50, 214, 176, 0.15);
      border: 1px solid rgba(50, 214, 176, 0.45);
      color: #96ffe9;
      padding: 8px 10px;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 900;
      animation: floatUp 1s ease forwards;
      pointer-events: none;
    }

    .modal {
      position: fixed;
      inset: 0;
      background: rgba(6, 12, 18, 0.7);
      backdrop-filter: blur(2px);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 12px;
      z-index: 20;
    }

    .modal.show { display: flex; }

    .shop {
      width: min(900px, 100%);
      border-radius: 16px;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      box-shadow: var(--chip-shadow);
      padding: 14px;
      display: grid;
      gap: 10px;
    }

    .shop-grid {
      display: grid;
      grid-template-columns: repeat(5, minmax(120px, 1fr));
      gap: 8px;
    }

    .shop-item {
      border: 1px solid var(--border);
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.03);
      padding: 10px;
      display: grid;
      gap: 8px;
      align-content: space-between;
    }

    .shop-item .name {
      font-weight: 800;
      color: var(--gold);
      font-size: 0.9rem;
    }

    .shop-item .desc {
      color: var(--muted);
      font-size: 0.78rem;
      line-height: 1.25;
      min-height: 48px;
    }

    .tag {
      font-size: 0.78rem;
      font-weight: 700;
      color: var(--good);
    }

    @keyframes floatUp {
      0% { opacity: 0; transform: translateY(10px) scale(0.96); }
      20% { opacity: 1; }
      100% { opacity: 0; transform: translateY(-34px) scale(1.02); }
    }

    @keyframes dealIn {
      from { opacity: 0; transform: translateY(8px) scale(0.95); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    @media (max-width: 980px) {
      .app { grid-template-columns: 1fr; }
      .shop-grid { grid-template-columns: repeat(2, minmax(120px, 1fr)); }
    }

    @media (max-width: 600px) {
      body { padding: 8px; }
      .cards-wrap { grid-template-columns: repeat(4, minmax(58px, 1fr)); }
      .card { min-height: 84px; padding: 7px; }
      .joker-area { grid-template-columns: repeat(3, minmax(80px, 1fr)); }
      .status-grid { grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="topbar">
      <div>
        <div class="title">블라인드 러시</div>
        <div class="subtitle">발라트로 감성 포커 로그라이크 (3 라운드)</div>
      </div>
      <div class="row">
        <button id="themeBtn">테마 전환</button>
        <button id="restartBtn">새 런 시작</button>
      </div>
    </header>

    <section class="panel">
      <div class="status-grid">
        <div class="stat">
          <div class="k">라운드</div>
          <div class="v" id="roundLabel">-</div>
        </div>
        <div class="stat">
          <div class="k">블라인드 목표</div>
          <div class="v blind" id="targetLabel">0</div>
        </div>
        <div class="stat">
          <div class="k">현재 점수</div>
          <div class="v score" id="scoreLabel">0</div>
        </div>
        <div class="stat">
          <div class="k">자금</div>
          <div class="v" id="moneyLabel">$0</div>
        </div>
        <div class="stat">
          <div class="k">남은 핸드</div>
          <div class="v" id="handsLabel">0</div>
        </div>
        <div class="stat">
          <div class="k">남은 버리기</div>
          <div class="v" id="discardsLabel">0</div>
        </div>
      </div>

      <div style="height: 10px"></div>
      <div class="info-line" id="handResult">핸드를 선택해 플레이하세요.</div>

      <div style="height: 10px"></div>
      <div class="actions">
        <button class="btn-main" id="playBtn">선택 카드 플레이</button>
        <button class="btn-warn" id="discardBtn">선택 카드 버리기</button>
        <button id="clearBtn">선택 해제</button>
      </div>

      <div style="height: 12px"></div>
      <div class="info-line">조커 슬롯 (최대 5)</div>
      <div style="height: 8px"></div>
      <div class="joker-area" id="jokerArea"></div>

      <div style="height: 12px"></div>
      <div class="info-line">전투 로그</div>
      <div style="height: 6px"></div>
      <div class="log" id="log"></div>
    </section>

    <section class="panel table" id="tablePanel">
      <div class="info-line">손패 8장 중 최대 5장을 선택</div>
      <div class="cards-wrap" id="cardsWrap"></div>
    </section>
  </div>

  <div class="modal" id="shopModal">
    <div class="shop">
      <div class="row" style="justify-content: space-between;">
        <div>
          <div class="title" style="font-size:1rem;">상점</div>
          <div class="subtitle">조커를 사서 다음 블라인드를 대비하세요.</div>
        </div>
        <div class="tag" id="shopMoney">보유 자금: $0</div>
      </div>
      <div class="shop-grid" id="shopGrid"></div>
      <div class="row" style="justify-content: flex-end;">
        <button class="btn-main" id="nextRoundBtn">다음 라운드</button>
      </div>
    </div>
  </div>

  <script>
    const suits = ["heart", "diamond", "club", "spade"];
    const suitSymbol = { heart: "♥", diamond: "♦", club: "♣", spade: "♠" };
    const suitClass = { heart: "s-heart", diamond: "s-diamond", club: "s-club", spade: "s-spade" };
    const rankList = [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14];
    const rankLabel = { 11: "J", 12: "Q", 13: "K", 14: "A" };

    const handBase = {
      HIGH_CARD: { name: "하이카드", chips: 5, mult: 1 },
      PAIR: { name: "원페어", chips: 10, mult: 2 },
      TWO_PAIR: { name: "투페어", chips: 20, mult: 2 },
      THREE: { name: "트리플", chips: 30, mult: 3 },
      STRAIGHT: { name: "스트레이트", chips: 30, mult: 4 },
      FLUSH: { name: "플러시", chips: 35, mult: 4 },
      FULL_HOUSE: { name: "풀하우스", chips: 40, mult: 4 },
      FOUR: { name: "포카드", chips: 60, mult: 7 },
      STRAIGHT_FLUSH: { name: "스트레이트 플러시", chips: 100, mult: 8 }
    };

    const roundDefs = [
      { id: "small", label: "스몰 블라인드", target: 300 },
      { id: "big", label: "빅 블라인드", target: 700 },
      { id: "boss", label: "보스 블라인드", target: 1500 }
    ];

    const jokerPool = [
      {
        id: "flat50",
        name: "칩 폭탄",
        cost: 6,
        desc: "핸드 점수 계산 시 칩 +50",
        apply(ctx) { ctx.chips += 50; }
      },
      {
        id: "flushx2",
        name: "물결 조커",
        cost: 7,
        desc: "플러시 계열이면 배수 x2",
        apply(ctx) {
          if (ctx.handType === "FLUSH" || ctx.handType === "STRAIGHT_FLUSH") ctx.mult *= 2;
        }
      },
      {
        id: "perCardMult",
        name: "계산기 조커",
        cost: 5,
        desc: "플레이한 카드 1장당 배수 +1",
        apply(ctx) { ctx.mult += ctx.cards.length; }
      },
      {
        id: "heartChip",
        name: "붉은 인장",
        cost: 5,
        desc: "하트 카드 1장당 칩 +15",
        apply(ctx) {
          const hearts = ctx.cards.filter(c => c.suit === "heart").length;
          ctx.chips += hearts * 15;
        }
      },
      {
        id: "pairBoost",
        name: "듀오 증폭기",
        cost: 8,
        desc: "원페어 이상이면 배수 +2",
        apply(ctx) {
          if (ctx.handType !== "HIGH_CARD") ctx.mult += 2;
        }
      }
    ];

    const state = {
      roundIndex: 0,
      score: 0,
      money: 10,
      handsLeft: 4,
      discardsLeft: 3,
      deck: [],
      hand: [],
      selected: new Set(),
      jokers: [],
      gameEnded: false
    };

    const $ = sel => document.querySelector(sel);
    const cardsWrap = $("#cardsWrap");
    const handResult = $("#handResult");
    const logEl = $("#log");
    const jokerArea = $("#jokerArea");
    const tablePanel = $("#tablePanel");

    function buildDeck() {
      let id = 0;
      const deck = [];
      for (const suit of suits) {
        for (const rank of rankList) deck.push({ id: id++, suit, rank });
      }
      for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
      return deck;
    }

    function formatRank(rank) {
      return rankLabel[rank] || String(rank);
    }

    function drawToEight() {
      while (state.hand.length < 8 && state.deck.length > 0) {
        state.hand.push(state.deck.pop());
      }
    }

    function setInfo(msg) {
      handResult.innerHTML = msg;
    }

    function addLog(msg) {
      const el = document.createElement("div");
      el.textContent = msg;
      logEl.prepend(el);
      while (logEl.children.length > 40) logEl.removeChild(logEl.lastChild);
    }

    function renderCards() {
      cardsWrap.innerHTML = "";
      state.hand.forEach(card => {
        const d = document.createElement("div");
        d.className = `card ${suitClass[card.suit]} ${state.selected.has(card.id) ? "selected" : ""}`;
        d.innerHTML = `<div class="rank">${formatRank(card.rank)}</div><div class="suit">${suitSymbol[card.suit]}</div>`;
        d.addEventListener("click", () => {
          if (state.gameEnded) return;
          if (state.selected.has(card.id)) state.selected.delete(card.id);
          else {
            if (state.selected.size >= 5) {
              setInfo("최대 5장까지만 선택 가능합니다.");
              return;
            }
            state.selected.add(card.id);
          }
          renderCards();
        });
        cardsWrap.appendChild(d);
      });
    }

    function renderJokers() {
      jokerArea.innerHTML = "";
      for (let i = 0; i < 5; i++) {
        const joker = state.jokers[i];
        const box = document.createElement("div");
        if (!joker) {
          box.className = "joker empty";
          box.textContent = "빈 슬롯";
        } else {
          box.className = "joker";
          box.innerHTML = `<div class="name">${joker.name}</div><div>${joker.desc}</div>`;
        }
        jokerArea.appendChild(box);
      }
    }

    function renderHUD() {
      const round = roundDefs[state.roundIndex] || roundDefs[roundDefs.length - 1];
      $("#roundLabel").textContent = `${state.roundIndex + 1}/3 (${round.label})`;
      $("#targetLabel").textContent = round.target.toLocaleString();
      $("#scoreLabel").textContent = state.score.toLocaleString();
      $("#moneyLabel").textContent = `$${state.money}`;
      $("#handsLabel").textContent = String(state.handsLeft);
      $("#discardsLabel").textContent = String(state.discardsLeft);
      $("#playBtn").disabled = state.gameEnded;
      $("#discardBtn").disabled = state.gameEnded;
      renderJokers();
    }

    function selectedCards() {
      return state.hand.filter(c => state.selected.has(c.id));
    }

    function scoreHand(cards) {
      if (!cards.length) return { handType: "HIGH_CARD", ...handBase.HIGH_CARD };
      const ranks = cards.map(c => c.rank).sort((a, b) => a - b);
      const suitsOnly = cards.map(c => c.suit);
      const counts = Object.values(ranks.reduce((m, r) => ((m[r] = (m[r] || 0) + 1), m), {})).sort((a, b) => b - a);

      const isFive = cards.length === 5;
      const isFlush = isFive && new Set(suitsOnly).size === 1;
      let isStraight = false;
      if (isFive) {
        const uniq = [...new Set(ranks)];
        if (uniq.length === 5) {
          const normal = uniq[4] - uniq[0] === 4;
          const wheel = uniq.join(",") === "2,3,4,5,14";
          isStraight = normal || wheel;
        }
      }

      if (isStraight && isFlush) return { handType: "STRAIGHT_FLUSH", ...handBase.STRAIGHT_FLUSH };
      if (counts[0] === 4) return { handType: "FOUR", ...handBase.FOUR };
      if (counts[0] === 3 && counts[1] === 2) return { handType: "FULL_HOUSE", ...handBase.FULL_HOUSE };
      if (isFlush) return { handType: "FLUSH", ...handBase.FLUSH };
      if (isStraight) return { handType: "STRAIGHT", ...handBase.STRAIGHT };
      if (counts[0] === 3) return { handType: "THREE", ...handBase.THREE };
      if (counts[0] === 2 && counts[1] === 2) return { handType: "TWO_PAIR", ...handBase.TWO_PAIR };
      if (counts[0] === 2) return { handType: "PAIR", ...handBase.PAIR };
      return { handType: "HIGH_CARD", ...handBase.HIGH_CARD };
    }

    function animateScore(points) {
      const fx = document.createElement("div");
      fx.className = "fx";
      fx.textContent = `+${points.toLocaleString()} 점`;
      tablePanel.appendChild(fx);
      setTimeout(() => fx.remove(), 980);
    }

    function consumeSelectedCards() {
      state.hand = state.hand.filter(c => !state.selected.has(c.id));
      state.selected.clear();
      drawToEight();
      renderCards();
    }

    function canContinue() {
      const target = roundDefs[state.roundIndex].target;
      if (state.score >= target) {
        winRound();
        return false;
      }
      if (state.handsLeft <= 0) {
        loseRun();
        return false;
      }
      return true;
    }

    function playSelected() {
      if (state.gameEnded) return;
      const cards = selectedCards();
      if (!cards.length) {
        setInfo("먼저 카드를 1장 이상 선택하세요.");
        return;
      }
      const hand = scoreHand(cards);
      let chips = hand.chips;
      let mult = hand.mult;
      const ctx = { cards, handType: hand.handType, chips, mult };

      for (const joker of state.jokers) {
        joker.apply(ctx);
      }

      chips = Math.max(0, Math.floor(ctx.chips));
      mult = Math.max(1, Math.floor(ctx.mult * 100) / 100);
      const points = Math.floor(chips * mult);

      state.score += points;
      state.handsLeft -= 1;

      animateScore(points);
      setInfo(`<span class="hand-tag">${hand.name}</span> | ${chips}칩 × ${mult}배 = <b>${points.toLocaleString()}</b>점`);
      addLog(`${hand.name} 플레이: +${points}점 (남은 핸드 ${state.handsLeft})`);

      consumeSelectedCards();
      renderHUD();
      canContinue();
    }

    function discardSelected() {
      if (state.gameEnded) return;
      if (state.discardsLeft <= 0) {
        setInfo("버리기 횟수를 모두 사용했습니다.");
        return;
      }
      const cards = selectedCards();
      if (!cards.length) {
        setInfo("버릴 카드를 선택하세요.");
        return;
      }
      state.discardsLeft -= 1;
      consumeSelectedCards();
      setInfo(`${cards.length}장 버림 완료. 남은 버리기 ${state.discardsLeft}`);
      addLog(`${cards.length}장 버림. (남은 버리기 ${state.discardsLeft})`);
      renderHUD();
    }

    function openShop() {
      const grid = $("#shopGrid");
      grid.innerHTML = "";
      $("#shopMoney").textContent = `보유 자금: $${state.money}`;

      jokerPool.forEach(joker => {
        const owned = state.jokers.some(j => j.id === joker.id);
        const full = state.jokers.length >= 5;
        const afford = state.money >= joker.cost;
        const disabled = owned || full || !afford;

        const card = document.createElement("div");
        card.className = "shop-item";
        card.innerHTML = `
          <div class="name">${joker.name}</div>
          <div class="desc">${joker.desc}</div>
          <div class="tag">가격: $${joker.cost}</div>
        `;
        const btn = document.createElement("button");
        btn.textContent = owned ? "보유 중" : full ? "슬롯 가득 참" : afford ? "구매" : "자금 부족";
        btn.disabled = disabled;
        btn.addEventListener("click", () => {
          state.money -= joker.cost;
          state.jokers.push(joker);
          addLog(`조커 구매: ${joker.name} (-$${joker.cost})`);
          renderHUD();
          openShop();
        });
        card.appendChild(btn);
        grid.appendChild(card);
      });

      $("#shopModal").classList.add("show");
    }

    function closeShop() {
      $("#shopModal").classList.remove("show");
    }

    function startRound(index) {
      state.roundIndex = index;
      state.score = 0;
      state.handsLeft = 4;
      state.discardsLeft = 3;
      state.deck = buildDeck();
      state.hand = [];
      state.selected.clear();
      state.gameEnded = false;
      drawToEight();
      renderCards();
      renderHUD();
      setInfo("핸드를 선택해 플레이하세요.");
      addLog(`${roundDefs[index].label} 시작. 목표 ${roundDefs[index].target}점`);
    }

    function winRound() {
      const reward = 7 + state.handsLeft * 2 + state.discardsLeft;
      state.money += reward;
      addLog(`라운드 클리어! 보상 +$${reward}`);
      setInfo(`블라인드 돌파 성공! 보상 +$${reward}`);
      state.gameEnded = true;
      renderHUD();

      if (state.roundIndex >= roundDefs.length - 1) {
        setInfo("보스 블라인드 격파! 런 클리어. 새 런을 시작하세요.");
        addLog("런 클리어 완료.");
        return;
      }
      openShop();
    }

    function loseRun() {
      state.gameEnded = true;
      renderHUD();
      setInfo("핸드를 모두 사용했습니다. 게임 오버! 새 런을 시작하세요.");
      addLog("게임 오버.");
    }

    function newRun() {
      state.money = 10;
      state.jokers = [];
      logEl.innerHTML = "";
      closeShop();
      startRound(0);
    }

    $("#playBtn").addEventListener("click", playSelected);
    $("#discardBtn").addEventListener("click", discardSelected);
    $("#clearBtn").addEventListener("click", () => {
      state.selected.clear();
      renderCards();
      setInfo("선택을 해제했습니다.");
    });

    $("#nextRoundBtn").addEventListener("click", () => {
      closeShop();
      startRound(state.roundIndex + 1);
    });

    $("#restartBtn").addEventListener("click", newRun);

    $("#themeBtn").addEventListener("click", () => {
      document.documentElement.classList.toggle("light");
    });

    if (window.matchMedia && window.matchMedia("(prefers-color-scheme: light)").matches) {
      document.documentElement.classList.add("light");
    }

    newRun();
  </script>
</body>
</html>
