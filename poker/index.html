<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>í¬ì»¤ - í…ì‚¬ìŠ¤ í™€ë¤</title>
    <link rel="icon" href="icon.svg" type="image/svg+xml">
    <style>
        :root {
            --bg: #0d1117;
            --table: #1a472a;
            --table-border: #2d5a3d;
            --card-bg: #fff;
            --card-back: #1e3a5f;
            --text: #e6edf3;
            --gold: #ffd700;
            --red: #ef4444;
            --chip: #22c55e;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .game-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 10px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
        }

        h1 {
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-buttons {
            display: flex;
            gap: 8px;
        }

        .btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: var(--text);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .btn.primary {
            background: var(--chip);
            border-color: var(--chip);
            color: #000;
        }

        /* í…Œì´ë¸” ì˜ì—­ */
        .poker-table {
            background: linear-gradient(145deg, var(--table), #0f2d1a);
            border: 8px solid var(--table-border);
            border-radius: 120px;
            padding: 20px;
            margin: 10px 0;
            min-height: 400px;
            position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5), inset 0 0 60px rgba(0,0,0,0.3);
        }

        /* í”Œë ˆì´ì–´ ì˜ì—­ */
        .player-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .opponent-area {
            margin-bottom: 20px;
        }

        .my-area {
            margin-top: 20px;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0,0,0,0.4);
            padding: 8px 16px;
            border-radius: 20px;
        }

        .player-name {
            font-weight: 600;
        }

        .chip-count {
            color: var(--gold);
            font-weight: 700;
        }

        .dealer-btn {
            background: var(--gold);
            color: #000;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 700;
        }

        /* ì¹´ë“œ */
        .cards {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .card {
            width: 60px;
            height: 84px;
            background: var(--card-bg);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            font-weight: 700;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: transform 0.3s;
        }

        .card.back {
            background: linear-gradient(135deg, var(--card-back), #0f2840);
            background-image: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.03) 10px,
                rgba(255,255,255,0.03) 20px
            );
        }

        .card.red { color: var(--red); }
        .card.black { color: #1a1a1a; }

        .card .rank {
            font-size: 1.4rem;
            line-height: 1;
        }

        .card .suit {
            font-size: 1.6rem;
            line-height: 1;
        }

        /* ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ */
        .community-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
        }

        .community-cards {
            display: flex;
            gap: 8px;
        }

        .community-cards .card {
            width: 55px;
            height: 77px;
        }

        .pot-display {
            background: rgba(0,0,0,0.5);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 1.1rem;
        }

        .pot-amount {
            color: var(--gold);
            font-weight: 700;
        }

        /* ë² íŒ… ì»¨íŠ¸ë¡¤ */
        .betting-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            margin-top: 10px;
        }

        .bet-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .bet-btn {
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .bet-btn.fold {
            background: #6b7280;
            color: white;
        }

        .bet-btn.check, .bet-btn.call {
            background: #3b82f6;
            color: white;
        }

        .bet-btn.raise, .bet-btn.bet {
            background: var(--chip);
            color: #000;
        }

        .bet-btn.allin {
            background: var(--red);
            color: white;
        }

        .bet-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .bet-slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bet-slider {
            flex: 1;
            height: 8px;
            -webkit-appearance: none;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
        }

        .bet-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: var(--gold);
            border-radius: 50%;
            cursor: pointer;
        }

        .bet-amount-display {
            min-width: 80px;
            text-align: center;
            font-weight: 700;
            color: var(--gold);
        }

        /* ë©”ì‹œì§€ */
        .game-message {
            text-align: center;
            padding: 10px;
            font-size: 1.1rem;
            min-height: 40px;
        }

        .hand-result {
            background: rgba(0,0,0,0.6);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1c2128;
            border-radius: 16px;
            padding: 24px;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            width: 100%;
        }

        .modal h2 {
            margin-bottom: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .hand-rank {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .hand-rank-num {
            width: 30px;
            height: 30px;
            background: var(--gold);
            color: #000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .hand-rank-name {
            font-weight: 600;
            flex: 1;
        }

        .hand-rank-desc {
            font-size: 0.85rem;
            color: #9ca3af;
        }

        /* ê²°ê³¼ í™”ë©´ */
        .result-overlay {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            padding: 30px 50px;
            border-radius: 16px;
            text-align: center;
            z-index: 100;
        }

        .result-overlay.active {
            display: block;
            animation: popIn 0.3s ease;
        }

        @keyframes popIn {
            from { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .result-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .result-title.win { color: var(--gold); }
        .result-title.lose { color: var(--red); }
        .result-title.tie { color: #9ca3af; }

        .result-detail {
            font-size: 1rem;
            margin-bottom: 20px;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 480px) {
            .card {
                width: 50px;
                height: 70px;
                font-size: 1rem;
            }

            .card .rank { font-size: 1.2rem; }
            .card .suit { font-size: 1.3rem; }

            .community-cards .card {
                width: 45px;
                height: 63px;
            }

            .poker-table {
                border-radius: 60px;
                padding: 15px;
            }

            .bet-btn {
                padding: 10px 16px;
                font-size: 0.9rem;
            }
        }

        .action-indicator {
            position: absolute;
            background: var(--gold);
            color: #000;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .current-bet {
            font-size: 0.9rem;
            color: var(--gold);
        }

        /* ===== Multiplayer UI ===== */
        .mode-select {
            position: fixed;
            inset: 0;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 200;
            gap: 20px;
        }

        .mode-select.hidden { display: none; }

        .mode-select h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .mode-select p {
            color: #9ca3af;
            margin-bottom: 30px;
        }

        .mode-buttons {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .mode-btn {
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 16px;
            padding: 30px 40px;
            color: var(--text);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            min-width: 200px;
        }

        .mode-btn:hover {
            background: rgba(255,255,255,0.2);
            border-color: var(--gold);
            transform: translateY(-4px);
        }

        .mode-btn .icon {
            font-size: 3rem;
            display: block;
            margin-bottom: 10px;
        }

        .mode-btn .label {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .mode-btn .desc {
            font-size: 0.85rem;
            color: #9ca3af;
            margin-top: 5px;
        }

        /* Lobby */
        .lobby {
            position: fixed;
            inset: 0;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            z-index: 200;
            overflow-y: auto;
        }

        .lobby.hidden { display: none; }

        .lobby-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            width: 100%;
            max-width: 500px;
        }

        .lobby-header h2 {
            flex: 1;
            font-size: 1.5rem;
        }

        .lobby-content {
            width: 100%;
            max-width: 500px;
        }

        .lobby-section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .lobby-section h3 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        .input-group input {
            flex: 1;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--text);
            font-size: 1rem;
        }

        .input-group input::placeholder {
            color: #666;
        }

        /* Waiting Room */
        .waiting-room {
            position: fixed;
            inset: 0;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 200;
        }

        .waiting-room.hidden { display: none; }

        .room-code {
            font-size: 3rem;
            font-weight: 700;
            letter-spacing: 8px;
            color: var(--gold);
            margin: 20px 0;
        }

        .room-code-label {
            color: #9ca3af;
            font-size: 0.9rem;
        }

        .player-list {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            width: 100%;
            max-width: 400px;
            margin: 20px 0;
        }

        .player-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .player-item:last-child { border-bottom: none; }

        .player-item .name { flex: 1; }

        .player-item .status {
            font-size: 0.85rem;
            padding: 4px 10px;
            border-radius: 12px;
            background: rgba(255,255,255,0.1);
        }

        .player-item .status.ready {
            background: var(--chip);
            color: #000;
        }

        .player-item .status.host {
            background: var(--gold);
            color: #000;
        }

        .waiting-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .copy-btn {
            background: none;
            border: 1px solid rgba(255,255,255,0.3);
            color: var(--text);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .copy-btn:hover { background: rgba(255,255,255,0.1); }

        /* Loading States */
        .btn.loading, .mode-btn.loading {
            pointer-events: none;
            opacity: 0.7;
            position: relative;
        }

        .btn.loading::after, .mode-btn.loading::after {
            content: '';
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            display: inline-block;
            margin-left: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .share-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .share-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: var(--text);
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .share-btn:hover { background: rgba(255,255,255,0.2); }
        .share-btn.primary { background: var(--chip); color: #000; border-color: var(--chip); }
    </style>
</head>
<body>
    <!-- Mode Selection -->
    <div class="mode-select" id="modeSelect">
        <h1>ğŸƒ í…ì‚¬ìŠ¤ í™€ë¤</h1>
        <p>ê²Œì„ ëª¨ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
        <div class="mode-buttons">
            <button class="mode-btn" onclick="startSinglePlayer()">
                <span class="icon">ğŸ¤–</span>
                <span class="label">ì‹±ê¸€í”Œë ˆì´</span>
                <span class="desc">AIì™€ 1:1 ëŒ€ì „</span>
            </button>
            <button class="mode-btn" onclick="showLobby()">
                <span class="icon">ğŸ‘¥</span>
                <span class="label">ë©€í‹°í”Œë ˆì´</span>
                <span class="desc">ì¹œêµ¬ì™€ ëŒ€ì „</span>
            </button>
        </div>
    </div>

    <!-- Multiplayer Lobby -->
    <div class="lobby hidden" id="lobby">
        <div class="lobby-header">
            <button class="btn" onclick="backToModeSelect()">â† ë’¤ë¡œ</button>
            <h2>ğŸ‘¥ ë©€í‹°í”Œë ˆì´</h2>
        </div>
        <div class="lobby-content">
            <div class="lobby-section">
                <h3>ğŸ® ìƒˆ ê²Œì„ ë§Œë“¤ê¸°</h3>
                <div class="input-group">
                    <input type="text" id="nicknameInput" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" maxlength="20">
                    <button class="btn primary" onclick="createMultiplayerRoom()">ë°© ë§Œë“¤ê¸°</button>
                </div>
            </div>
            <div class="lobby-section">
                <h3>ğŸ”— ë°© ì°¸ê°€í•˜ê¸°</h3>
                <div class="input-group">
                    <input type="text" id="roomCodeInput" placeholder="ë°© ì½”ë“œ (6ìë¦¬)" maxlength="6" style="text-transform: uppercase;">
                    <button class="btn primary" onclick="joinMultiplayerRoom()">ì°¸ê°€</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Waiting Room -->
    <div class="waiting-room hidden" id="waitingRoom">
        <button class="btn" onclick="leaveWaitingRoom()" style="position:absolute;top:20px;left:20px;">â† ë‚˜ê°€ê¸°</button>
        <h2>ëŒ€ê¸°ì‹¤</h2>
        <div class="room-code-label">ë°© ì½”ë“œ</div>
        <div class="room-code" id="displayRoomCode">------</div>
        <div class="share-buttons">
            <button class="share-btn" onclick="copyRoomCode()">ğŸ“‹ ì½”ë“œ ë³µì‚¬</button>
            <button class="share-btn primary" onclick="shareRoomLink()">ğŸ”— ë§í¬ ê³µìœ </button>
        </div>
        
        <div class="player-list" id="playerList">
            <!-- Players will be listed here -->
        </div>
        
        <div class="waiting-actions">
            <button class="btn" id="readyBtn" onclick="toggleReady()">ì¤€ë¹„</button>
            <button class="btn primary" id="startBtn" onclick="startMultiplayerGame()" style="display:none;">ê²Œì„ ì‹œì‘</button>
        </div>
        <p id="waitingMessage" style="color:#9ca3af;margin-top:15px;">ë‹¤ë¥¸ í”Œë ˆì´ì–´ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</p>
    </div>

    <div class="game-container" id="gameContainer" style="display:none;">
        <header>
            <h1>ğŸƒ í¬ì»¤</h1>
            <div class="header-buttons">
                <button class="btn" onclick="showRules()">ğŸ“– ë£°</button>
                <button class="btn primary" onclick="newGame()">ìƒˆ ê²Œì„</button>
            </div>
        </header>

        <div class="poker-table">
            <!-- ìƒëŒ€ ì˜ì—­ -->
            <div class="player-area opponent-area">
                <div class="player-info">
                    <span class="player-name">ğŸ¤– ì»´í“¨í„°</span>
                    <span class="chip-count" id="opponentChips">1000</span>
                    <span class="dealer-btn" id="opponentDealer" style="display:none">D</span>
                </div>
                <div class="cards" id="opponentCards"></div>
                <div class="hand-result" id="opponentHand" style="display:none"></div>
                <div class="current-bet" id="opponentBet"></div>
            </div>

            <!-- ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ -->
            <div class="community-area">
                <div class="community-cards" id="communityCards"></div>
                <div class="pot-display">
                    íŒŸ: <span class="pot-amount" id="potAmount">0</span>
                </div>
            </div>

            <!-- ê²°ê³¼ ì˜¤ë²„ë ˆì´ -->
            <div class="result-overlay" id="resultOverlay">
                <div class="result-title" id="resultTitle">ìŠ¹ë¦¬!</div>
                <div class="result-detail" id="resultDetail"></div>
                <button class="btn primary" onclick="nextHand()">ë‹¤ìŒ í•¸ë“œ</button>
            </div>

            <!-- ë‚´ ì˜ì—­ -->
            <div class="player-area my-area">
                <div class="current-bet" id="myBet"></div>
                <div class="cards" id="myCards"></div>
                <div class="hand-result" id="myHand"></div>
                <div class="player-info">
                    <span class="player-name">ğŸ‘¤ ë‚˜</span>
                    <span class="chip-count" id="myChips">1000</span>
                    <span class="dealer-btn" id="myDealer" style="display:none">D</span>
                </div>
            </div>
        </div>

        <div class="game-message" id="gameMessage">ìƒˆ ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”!</div>

        <div class="betting-controls" id="bettingControls" style="display:none">
            <div class="bet-slider-container" id="raiseContainer" style="display:none">
                <input type="range" class="bet-slider" id="betSlider" min="0" max="1000" value="20">
                <div class="bet-amount-display" id="betAmountDisplay">20</div>
            </div>
            <div class="bet-buttons" id="betButtons"></div>
        </div>
    </div>

    <!-- ë£° ëª¨ë‹¬ -->
    <div class="modal" id="rulesModal">
        <div class="modal-content">
            <h2>
                ğŸ“– í…ì‚¬ìŠ¤ í™€ë¤ ë£°
                <button class="close-btn" onclick="closeRules()">Ã—</button>
            </h2>

            <h3 style="margin: 16px 0 8px">ğŸ® ê²Œì„ ì§„í–‰</h3>
            <p style="line-height: 1.6; color: #9ca3af; margin-bottom: 16px">
                1. ê° í”Œë ˆì´ì–´ì—ê²Œ 2ì¥ì˜ ì¹´ë“œ(í™€ì¹´ë“œ)ê°€ ë°°ë¶„ë©ë‹ˆë‹¤.<br>
                2. 5ì¥ì˜ ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œê°€ ìˆœì°¨ì ìœ¼ë¡œ ê³µê°œë©ë‹ˆë‹¤.<br>
                3. í™€ì¹´ë“œ 2ì¥ + ì»¤ë®¤ë‹ˆí‹° 5ì¥ ì¤‘ 5ì¥ìœ¼ë¡œ ìµœê³  ì¡°í•©ì„ ë§Œë“­ë‹ˆë‹¤.<br>
                4. ë² íŒ… ë¼ìš´ë“œ: í”„ë¦¬í”Œë â†’ í”Œë â†’ í„´ â†’ ë¦¬ë²„
            </p>

            <h3 style="margin: 16px 0 8px">ğŸ’° ë² íŒ… ì•¡ì…˜</h3>
            <p style="line-height: 1.6; color: #9ca3af; margin-bottom: 16px">
                <b>í´ë“œ</b>: í¬ê¸°í•˜ê³  íŒŸì„ ìƒëŒ€ì—ê²Œ ì–‘ë³´<br>
                <b>ì²´í¬</b>: ë² íŒ… ì—†ì´ ì°¨ë¡€ ë„˜ê¸°ê¸° (ìƒëŒ€ê°€ ë² íŒ… ì•ˆí–ˆì„ ë•Œ)<br>
                <b>ì½œ</b>: ìƒëŒ€ ë² íŒ…ê³¼ ê°™ì€ ê¸ˆì•¡ ë² íŒ…<br>
                <b>ë ˆì´ì¦ˆ</b>: ìƒëŒ€ ë² íŒ…ë³´ë‹¤ ë” ë§ì´ ë² íŒ…<br>
                <b>ì˜¬ì¸</b>: ëª¨ë“  ì¹©ì„ ë² íŒ…
            </p>

            <h3 style="margin: 16px 0 8px">ğŸ† í•¸ë“œ ìˆœìœ„ (ë†’ì€ ìˆœ)</h3>
            
            <div class="hand-rank">
                <div class="hand-rank-num">1</div>
                <div>
                    <div class="hand-rank-name">ë¡œì–„ í”ŒëŸ¬ì‹œ</div>
                    <div class="hand-rank-desc">A K Q J 10 ê°™ì€ ë¬´ëŠ¬</div>
                </div>
            </div>
            
            <div class="hand-rank">
                <div class="hand-rank-num">2</div>
                <div>
                    <div class="hand-rank-name">ìŠ¤íŠ¸ë ˆì´íŠ¸ í”ŒëŸ¬ì‹œ</div>
                    <div class="hand-rank-desc">ì—°ì† 5ì¥ ê°™ì€ ë¬´ëŠ¬</div>
                </div>
            </div>
            
            <div class="hand-rank">
                <div class="hand-rank-num">3</div>
                <div>
                    <div class="hand-rank-name">í¬ì¹´ë“œ</div>
                    <div class="hand-rank-desc">ê°™ì€ ìˆ«ì 4ì¥</div>
                </div>
            </div>
            
            <div class="hand-rank">
                <div class="hand-rank-num">4</div>
                <div>
                    <div class="hand-rank-name">í’€í•˜ìš°ìŠ¤</div>
                    <div class="hand-rank-desc">íŠ¸ë¦¬í”Œ + í˜ì–´</div>
                </div>
            </div>
            
            <div class="hand-rank">
                <div class="hand-rank-num">5</div>
                <div>
                    <div class="hand-rank-name">í”ŒëŸ¬ì‹œ</div>
                    <div class="hand-rank-desc">ê°™ì€ ë¬´ëŠ¬ 5ì¥</div>
                </div>
            </div>
            
            <div class="hand-rank">
                <div class="hand-rank-num">6</div>
                <div>
                    <div class="hand-rank-name">ìŠ¤íŠ¸ë ˆì´íŠ¸</div>
                    <div class="hand-rank-desc">ì—°ì† ìˆ«ì 5ì¥</div>
                </div>
            </div>
            
            <div class="hand-rank">
                <div class="hand-rank-num">7</div>
                <div>
                    <div class="hand-rank-name">íŠ¸ë¦¬í”Œ</div>
                    <div class="hand-rank-desc">ê°™ì€ ìˆ«ì 3ì¥</div>
                </div>
            </div>
            
            <div class="hand-rank">
                <div class="hand-rank-num">8</div>
                <div>
                    <div class="hand-rank-name">íˆ¬í˜ì–´</div>
                    <div class="hand-rank-desc">í˜ì–´ 2ê°œ</div>
                </div>
            </div>
            
            <div class="hand-rank">
                <div class="hand-rank-num">9</div>
                <div>
                    <div class="hand-rank-name">ì›í˜ì–´</div>
                    <div class="hand-rank-desc">ê°™ì€ ìˆ«ì 2ì¥</div>
                </div>
            </div>
            
            <div class="hand-rank">
                <div class="hand-rank-num">10</div>
                <div>
                    <div class="hand-rank-name">í•˜ì´ì¹´ë“œ</div>
                    <div class="hand-rank-desc">ê°€ì¥ ë†’ì€ ì¹´ë“œ</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== ê²Œì„ ìƒíƒœ =====
        const SUITS = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
        const RANKS = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
        
        const HAND_NAMES = [
            'í•˜ì´ì¹´ë“œ', 'ì›í˜ì–´', 'íˆ¬í˜ì–´', 'íŠ¸ë¦¬í”Œ', 
            'ìŠ¤íŠ¸ë ˆì´íŠ¸', 'í”ŒëŸ¬ì‹œ', 'í’€í•˜ìš°ìŠ¤', 'í¬ì¹´ë“œ', 
            'ìŠ¤íŠ¸ë ˆì´íŠ¸ í”ŒëŸ¬ì‹œ', 'ë¡œì–„ í”ŒëŸ¬ì‹œ'
        ];

        let game = {
            deck: [],
            myCards: [],
            opponentCards: [],
            communityCards: [],
            myChips: 1000,
            opponentChips: 1000,
            pot: 0,
            myBet: 0,
            opponentBet: 0,
            dealer: 'me', // 'me' or 'opponent'
            phase: 'idle', // idle, preflop, flop, turn, river, showdown
            currentPlayer: null,
            bigBlind: 20,
            smallBlind: 10,
            minRaise: 20,
            lastRaise: 0
        };

        // ===== ë± ê´€ë¦¬ =====
        function createDeck() {
            const deck = [];
            for (const suit of SUITS) {
                for (const rank of RANKS) {
                    deck.push({ suit, rank });
                }
            }
            return shuffle(deck);
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function drawCards(count) {
            return game.deck.splice(0, count);
        }

        // ===== ì¹´ë“œ ë Œë”ë§ =====
        function renderCard(card, faceDown = false) {
            if (faceDown) {
                return '<div class="card back"></div>';
            }
            const isRed = card.suit === 'â™¥' || card.suit === 'â™¦';
            return `
                <div class="card ${isRed ? 'red' : 'black'}">
                    <span class="rank">${card.rank}</span>
                    <span class="suit">${card.suit}</span>
                </div>
            `;
        }

        function updateDisplay() {
            // ìƒëŒ€ ì¹´ë“œ
            const opponentCardsEl = document.getElementById('opponentCards');
            const showOpponent = game.phase === 'showdown';
            opponentCardsEl.innerHTML = game.opponentCards.map(c => renderCard(c, !showOpponent)).join('');

            // ë‚´ ì¹´ë“œ
            document.getElementById('myCards').innerHTML = game.myCards.map(c => renderCard(c)).join('');

            // ì»¤ë®¤ë‹ˆí‹° ì¹´ë“œ
            document.getElementById('communityCards').innerHTML = game.communityCards.map(c => renderCard(c)).join('');

            // ì¹©
            document.getElementById('myChips').textContent = game.myChips;
            document.getElementById('opponentChips').textContent = game.opponentChips;
            document.getElementById('potAmount').textContent = game.pot;

            // í˜„ì¬ ë² íŒ…
            document.getElementById('myBet').textContent = game.myBet > 0 ? `ë² íŒ…: ${game.myBet}` : '';
            document.getElementById('opponentBet').textContent = game.opponentBet > 0 ? `ë² íŒ…: ${game.opponentBet}` : '';

            // ë”œëŸ¬ ë²„íŠ¼
            document.getElementById('myDealer').style.display = game.dealer === 'me' ? 'inline' : 'none';
            document.getElementById('opponentDealer').style.display = game.dealer === 'opponent' ? 'inline' : 'none';

            // í•¸ë“œ ê²°ê³¼
            if (game.phase === 'showdown' || game.myCards.length > 0) {
                const myHand = evaluateHand([...game.myCards, ...game.communityCards]);
                document.getElementById('myHand').textContent = HAND_NAMES[myHand.rank];
                document.getElementById('myHand').style.display = 'block';
            } else {
                document.getElementById('myHand').style.display = 'none';
            }

            if (game.phase === 'showdown') {
                const oppHand = evaluateHand([...game.opponentCards, ...game.communityCards]);
                document.getElementById('opponentHand').textContent = HAND_NAMES[oppHand.rank];
                document.getElementById('opponentHand').style.display = 'block';
            } else {
                document.getElementById('opponentHand').style.display = 'none';
            }
        }

        // ===== í•¸ë“œ í‰ê°€ =====
        function getRankValue(rank) {
            return RANKS.indexOf(rank);
        }

        function evaluateHand(cards) {
            if (cards.length < 5) return { rank: 0, value: 0, kickers: [] };

            // 5ì¥ ì¡°í•© ì¤‘ ìµœê³  ì°¾ê¸°
            const combos = getCombinations(cards, 5);
            let best = { rank: 0, value: 0, kickers: [] };

            for (const combo of combos) {
                const result = evaluateFiveCards(combo);
                if (compareHands(result, best) > 0) {
                    best = result;
                }
            }

            return best;
        }

        function getCombinations(arr, size) {
            if (size === 1) return arr.map(x => [x]);
            const result = [];
            for (let i = 0; i <= arr.length - size; i++) {
                const head = arr[i];
                const tailCombos = getCombinations(arr.slice(i + 1), size - 1);
                for (const tail of tailCombos) {
                    result.push([head, ...tail]);
                }
            }
            return result;
        }

        function evaluateFiveCards(cards) {
            const ranks = cards.map(c => getRankValue(c.rank)).sort((a, b) => b - a);
            const suits = cards.map(c => c.suit);
            
            const isFlush = suits.every(s => s === suits[0]);
            const isStraight = checkStraight(ranks);
            const isWheel = ranks.join(',') === '12,3,2,1,0'; // A-2-3-4-5
            
            const rankCounts = {};
            ranks.forEach(r => rankCounts[r] = (rankCounts[r] || 0) + 1);
            const counts = Object.values(rankCounts).sort((a, b) => b - a);
            const countedRanks = Object.entries(rankCounts)
                .sort((a, b) => b[1] - a[1] || b[0] - a[0])
                .map(e => parseInt(e[0]));

            // ë¡œì–„ í”ŒëŸ¬ì‹œ
            if (isFlush && isStraight && ranks[0] === 12) {
                return { rank: 9, value: 12, kickers: [] };
            }

            // ìŠ¤íŠ¸ë ˆì´íŠ¸ í”ŒëŸ¬ì‹œ
            if (isFlush && (isStraight || isWheel)) {
                return { rank: 8, value: isWheel ? 3 : ranks[0], kickers: [] };
            }

            // í¬ì¹´ë“œ
            if (counts[0] === 4) {
                return { rank: 7, value: countedRanks[0], kickers: [countedRanks[1]] };
            }

            // í’€í•˜ìš°ìŠ¤
            if (counts[0] === 3 && counts[1] === 2) {
                return { rank: 6, value: countedRanks[0], kickers: [countedRanks[1]] };
            }

            // í”ŒëŸ¬ì‹œ
            if (isFlush) {
                return { rank: 5, value: ranks[0], kickers: ranks.slice(1) };
            }

            // ìŠ¤íŠ¸ë ˆì´íŠ¸
            if (isStraight || isWheel) {
                return { rank: 4, value: isWheel ? 3 : ranks[0], kickers: [] };
            }

            // íŠ¸ë¦¬í”Œ
            if (counts[0] === 3) {
                return { rank: 3, value: countedRanks[0], kickers: countedRanks.slice(1) };
            }

            // íˆ¬í˜ì–´
            if (counts[0] === 2 && counts[1] === 2) {
                return { rank: 2, value: Math.max(countedRanks[0], countedRanks[1]), 
                        kickers: [Math.min(countedRanks[0], countedRanks[1]), countedRanks[2]] };
            }

            // ì›í˜ì–´
            if (counts[0] === 2) {
                return { rank: 1, value: countedRanks[0], kickers: countedRanks.slice(1) };
            }

            // í•˜ì´ì¹´ë“œ
            return { rank: 0, value: ranks[0], kickers: ranks.slice(1) };
        }

        function checkStraight(ranks) {
            const unique = [...new Set(ranks)].sort((a, b) => b - a);
            if (unique.length < 5) return false;
            for (let i = 0; i < 4; i++) {
                if (unique[i] - unique[i + 1] !== 1) return false;
            }
            return true;
        }

        function compareHands(a, b) {
            if (a.rank !== b.rank) return a.rank - b.rank;
            if (a.value !== b.value) return a.value - b.value;
            for (let i = 0; i < Math.max(a.kickers.length, b.kickers.length); i++) {
                const ak = a.kickers[i] || 0;
                const bk = b.kickers[i] || 0;
                if (ak !== bk) return ak - bk;
            }
            return 0;
        }

        // ===== ê²Œì„ ë¡œì§ =====
        function newGame() {
            game.myChips = 1000;
            game.opponentChips = 1000;
            game.dealer = Math.random() < 0.5 ? 'me' : 'opponent';
            document.getElementById('resultOverlay').classList.remove('active');
            startHand();
        }

        function nextHand() {
            document.getElementById('resultOverlay').classList.remove('active');
            
            if (game.myChips <= 0) {
                showMessage('ì¹©ì´ ì—†ìŠµë‹ˆë‹¤! ìƒˆ ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”.');
                return;
            }
            if (game.opponentChips <= 0) {
                showMessage('ğŸ‰ ìŠ¹ë¦¬! ìƒëŒ€ ì¹©ì´ ì—†ìŠµë‹ˆë‹¤!');
                return;
            }
            
            game.dealer = game.dealer === 'me' ? 'opponent' : 'me';
            startHand();
        }

        function startHand() {
            game.deck = createDeck();
            game.myCards = drawCards(2);
            game.opponentCards = drawCards(2);
            game.communityCards = [];
            game.pot = 0;
            game.myBet = 0;
            game.opponentBet = 0;
            game.phase = 'preflop';
            game.minRaise = game.bigBlind;
            game.lastRaise = game.bigBlind;

            // ë¸”ë¼ì¸ë“œ ì„¤ì •
            if (game.dealer === 'me') {
                // ë‚´ê°€ ë”œëŸ¬ = ë‚´ê°€ ìŠ¤ëª°ë¸”ë¼ì¸ë“œ
                placeBet('me', Math.min(game.smallBlind, game.myChips));
                placeBet('opponent', Math.min(game.bigBlind, game.opponentChips));
                game.currentPlayer = 'me'; // ìŠ¤ëª°ë¸”ë¼ì¸ë“œê°€ ë¨¼ì €
            } else {
                placeBet('opponent', Math.min(game.smallBlind, game.opponentChips));
                placeBet('me', Math.min(game.bigBlind, game.myChips));
                game.currentPlayer = 'opponent';
            }

            updateDisplay();
            showMessage('í”„ë¦¬í”Œë');

            if (game.currentPlayer === 'opponent') {
                setTimeout(aiTurn, 1000);
            } else {
                showBettingControls();
            }
        }

        function placeBet(player, amount) {
            if (player === 'me') {
                const bet = Math.min(amount, game.myChips);
                game.myChips -= bet;
                game.myBet += bet;
                game.pot += bet;
            } else {
                const bet = Math.min(amount, game.opponentChips);
                game.opponentChips -= bet;
                game.opponentBet += bet;
                game.pot += bet;
            }
        }

        function showBettingControls() {
            const controls = document.getElementById('bettingControls');
            const buttons = document.getElementById('betButtons');
            const raiseContainer = document.getElementById('raiseContainer');
            
            controls.style.display = 'block';
            
            const toCall = game.opponentBet - game.myBet;
            const canRaise = game.myChips > toCall;
            
            let html = '<button class="bet-btn fold" onclick="playerAction(\'fold\')">í´ë“œ</button>';
            
            if (toCall === 0) {
                html += '<button class="bet-btn check" onclick="playerAction(\'check\')">ì²´í¬</button>';
            } else if (toCall > 0 && game.myChips >= toCall) {
                html += `<button class="bet-btn call" onclick="playerAction('call')">ì½œ (${toCall})</button>`;
            }
            
            if (canRaise && game.myChips > toCall) {
                html += '<button class="bet-btn raise" onclick="playerAction(\'raise\')">ë ˆì´ì¦ˆ</button>';
                raiseContainer.style.display = 'flex';
                
                const slider = document.getElementById('betSlider');
                const minRaise = toCall + game.minRaise;
                slider.min = minRaise;
                slider.max = game.myChips;
                slider.value = Math.min(minRaise * 2, game.myChips);
                updateBetDisplay();
            } else {
                raiseContainer.style.display = 'none';
            }
            
            if (game.myChips > 0) {
                html += `<button class="bet-btn allin" onclick="playerAction('allin')">ì˜¬ì¸ (${game.myChips})</button>`;
            }
            
            buttons.innerHTML = html;
        }

        function updateBetDisplay() {
            const slider = document.getElementById('betSlider');
            document.getElementById('betAmountDisplay').textContent = slider.value;
        }

        document.getElementById('betSlider').addEventListener('input', updateBetDisplay);

        function playerAction(action) {
            const toCall = game.opponentBet - game.myBet;
            
            switch (action) {
                case 'fold':
                    endHand('opponent');
                    return;
                    
                case 'check':
                    break;
                    
                case 'call':
                    placeBet('me', toCall);
                    break;
                    
                case 'raise':
                    const raiseAmount = parseInt(document.getElementById('betSlider').value);
                    placeBet('me', raiseAmount);
                    game.lastRaise = raiseAmount - toCall;
                    game.minRaise = game.lastRaise;
                    break;
                    
                case 'allin':
                    placeBet('me', game.myChips);
                    break;
            }
            
            document.getElementById('bettingControls').style.display = 'none';
            updateDisplay();
            
            // ë² íŒ… ë¼ìš´ë“œ ì²´í¬
            if (game.myBet === game.opponentBet || game.opponentChips === 0 || game.myChips === 0) {
                nextPhase();
            } else {
                game.currentPlayer = 'opponent';
                setTimeout(aiTurn, 800);
            }
        }

        // ===== AI =====
        function aiTurn() {
            const toCall = game.myBet - game.opponentBet;
            const hand = evaluateHand([...game.opponentCards, ...game.communityCards]);
            
            // í•¸ë“œ ê°•ë„ ê³„ì‚° (0-1)
            let handStrength = hand.rank / 9;
            
            // í”„ë¦¬í”Œë í•¸ë“œ ê°•ë„ ë³´ì •
            if (game.communityCards.length === 0) {
                handStrength = evaluatePreflopHand(game.opponentCards);
            }
            
            // íŒŸ ì˜¤ì¦ˆ ê³„ì‚°
            const potOdds = toCall / (game.pot + toCall);
            
            // ë¸”ëŸ¬í•‘ í™•ë¥ 
            const bluffChance = Math.random();
            
            let action;
            
            if (toCall === 0) {
                // ì²´í¬ ê°€ëŠ¥
                if (handStrength > 0.6 || (handStrength > 0.3 && bluffChance > 0.7)) {
                    // ë² íŒ…
                    const betSize = Math.floor(game.pot * (0.5 + handStrength * 0.5));
                    action = { type: 'raise', amount: Math.min(betSize, game.opponentChips) };
                } else {
                    action = { type: 'check' };
                }
            } else {
                // ì½œí•´ì•¼ í•¨
                if (handStrength > potOdds + 0.1 || (bluffChance > 0.85 && toCall < game.pot * 0.3)) {
                    // ì½œ ë˜ëŠ” ë ˆì´ì¦ˆ
                    if (handStrength > 0.7 && game.opponentChips > toCall * 2) {
                        const raiseAmount = toCall + Math.floor(game.pot * handStrength);
                        action = { type: 'raise', amount: Math.min(raiseAmount, game.opponentChips) };
                    } else {
                        action = { type: 'call' };
                    }
                } else if (handStrength > potOdds - 0.1) {
                    action = { type: 'call' };
                } else {
                    action = { type: 'fold' };
                }
            }
            
            // ì‹¤í–‰
            executeAiAction(action);
        }

        function evaluatePreflopHand(cards) {
            const r1 = getRankValue(cards[0].rank);
            const r2 = getRankValue(cards[1].rank);
            const suited = cards[0].suit === cards[1].suit;
            const pair = r1 === r2;
            
            let strength = (r1 + r2) / 24; // ê¸°ë³¸ ê°•ë„
            
            if (pair) strength += 0.3;
            if (suited) strength += 0.1;
            if (Math.abs(r1 - r2) <= 2) strength += 0.05; // ì»¤ë„¥í„°
            
            // í”„ë¦¬ë¯¸ì—„ í•¸ë“œ
            if (pair && r1 >= 10) strength = 0.9; // QQ+
            if (r1 === 12 && r2 >= 10) strength = 0.85; // AK, AQ, AJ
            
            return Math.min(strength, 1);
        }

        function executeAiAction(action) {
            const toCall = game.myBet - game.opponentBet;
            
            switch (action.type) {
                case 'fold':
                    showMessage('ğŸ¤– í´ë“œ');
                    setTimeout(() => endHand('me'), 500);
                    return;
                    
                case 'check':
                    showMessage('ğŸ¤– ì²´í¬');
                    break;
                    
                case 'call':
                    placeBet('opponent', toCall);
                    showMessage(`ğŸ¤– ì½œ (${toCall})`);
                    break;
                    
                case 'raise':
                    placeBet('opponent', action.amount);
                    showMessage(`ğŸ¤– ë ˆì´ì¦ˆ (${action.amount})`);
                    break;
            }
            
            updateDisplay();
            
            if (action.type === 'raise' && game.myChips > 0) {
                game.currentPlayer = 'me';
                setTimeout(showBettingControls, 500);
            } else {
                setTimeout(nextPhase, 500);
            }
        }

        function nextPhase() {
            game.myBet = 0;
            game.opponentBet = 0;
            
            switch (game.phase) {
                case 'preflop':
                    game.phase = 'flop';
                    game.communityCards = drawCards(3);
                    showMessage('í”Œë');
                    break;
                    
                case 'flop':
                    game.phase = 'turn';
                    game.communityCards.push(...drawCards(1));
                    showMessage('í„´');
                    break;
                    
                case 'turn':
                    game.phase = 'river';
                    game.communityCards.push(...drawCards(1));
                    showMessage('ë¦¬ë²„');
                    break;
                    
                case 'river':
                    showdown();
                    return;
            }
            
            updateDisplay();
            
            // ì˜¬ì¸ ìƒíƒœë©´ ìë™ ì§„í–‰
            if (game.myChips === 0 || game.opponentChips === 0) {
                setTimeout(nextPhase, 1000);
                return;
            }
            
            // ë”œëŸ¬ ë°˜ëŒ€ê°€ ë¨¼ì €
            game.currentPlayer = game.dealer === 'me' ? 'opponent' : 'me';
            
            if (game.currentPlayer === 'opponent') {
                setTimeout(aiTurn, 800);
            } else {
                showBettingControls();
            }
        }

        function showdown() {
            game.phase = 'showdown';
            updateDisplay();
            
            const myHand = evaluateHand([...game.myCards, ...game.communityCards]);
            const oppHand = evaluateHand([...game.opponentCards, ...game.communityCards]);
            
            const comparison = compareHands(myHand, oppHand);
            
            if (comparison > 0) {
                endHand('me', HAND_NAMES[myHand.rank]);
            } else if (comparison < 0) {
                endHand('opponent', HAND_NAMES[oppHand.rank]);
            } else {
                endHand('tie');
            }
        }

        function endHand(winner, winningHand = '') {
            game.phase = 'showdown';
            document.getElementById('bettingControls').style.display = 'none';
            
            const overlay = document.getElementById('resultOverlay');
            const title = document.getElementById('resultTitle');
            const detail = document.getElementById('resultDetail');
            
            if (winner === 'me') {
                game.myChips += game.pot;
                title.textContent = 'ğŸ‰ ìŠ¹ë¦¬!';
                title.className = 'result-title win';
                detail.textContent = winningHand ? `${winningHand}ìœ¼ë¡œ +${game.pot} íšë“` : `+${game.pot} íšë“`;
            } else if (winner === 'opponent') {
                game.opponentChips += game.pot;
                title.textContent = 'ğŸ˜¢ íŒ¨ë°°';
                title.className = 'result-title lose';
                detail.textContent = winningHand ? `ìƒëŒ€: ${winningHand}` : '';
            } else {
                game.myChips += game.pot / 2;
                game.opponentChips += game.pot / 2;
                title.textContent = 'ğŸ¤ ë¬´ìŠ¹ë¶€';
                title.className = 'result-title tie';
                detail.textContent = 'íŒŸ ë¶„ë°°';
            }
            
            game.pot = 0;
            updateDisplay();
            overlay.classList.add('active');
        }

        function showMessage(text) {
            document.getElementById('gameMessage').textContent = text;
        }

        function showRules() {
            document.getElementById('rulesModal').classList.add('active');
        }

        function closeRules() {
            document.getElementById('rulesModal').classList.remove('active');
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
        document.getElementById('rulesModal').addEventListener('click', (e) => {
            if (e.target.id === 'rulesModal') closeRules();
        });

        // ===== Multiplayer Mode =====
        let multiplayerClient = null;
        let isMultiplayer = false;
        let isHost = false;
        let myReady = false;

        function startSinglePlayer() {
            isMultiplayer = false;
            document.getElementById('modeSelect').classList.add('hidden');
            document.getElementById('gameContainer').style.display = 'block';
            updateDisplay();
        }

        function showLobby() {
            document.getElementById('modeSelect').classList.add('hidden');
            document.getElementById('lobby').classList.remove('hidden');
            
            // Restore nickname if saved
            const savedNickname = localStorage.getItem('poker_nickname');
            if (savedNickname) {
                document.getElementById('nicknameInput').value = savedNickname;
            }
        }

        function backToModeSelect() {
            document.getElementById('lobby').classList.add('hidden');
            document.getElementById('modeSelect').classList.remove('hidden');
        }

        async function createMultiplayerRoom() {
            const btn = event.target;
            if (btn.classList.contains('loading')) return;
            
            const nickname = document.getElementById('nicknameInput').value.trim();
            if (!nickname || nickname.length < 2) {
                alert('ë‹‰ë„¤ì„ì„ 2ì ì´ìƒ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }
            
            localStorage.setItem('poker_nickname', nickname);
            btn.classList.add('loading');
            
            try {
                multiplayerClient = new MultiplayerClient();
                await multiplayerClient.ensureAuth();
                await multiplayerClient.setNickname(nickname);
                
                const room = await multiplayerClient.createRoom({ startingChips: 1000, bigBlind: 20 });
                isHost = true;
                showWaitingRoom(room.roomId);
            } catch (e) {
                alert('ë°© ìƒì„± ì‹¤íŒ¨: ' + e.message);
            } finally {
                btn.classList.remove('loading');
            }
        }

        async function joinMultiplayerRoom() {
            const btn = event.target;
            if (btn.classList.contains('loading')) return;
            
            const roomCode = document.getElementById('roomCodeInput').value.trim().toUpperCase();
            if (!roomCode || roomCode.length !== 6) {
                alert('6ìë¦¬ ë°© ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }
            
            let nickname = document.getElementById('nicknameInput').value.trim();
            if (!nickname || nickname.length < 2) {
                nickname = 'Player_' + Math.random().toString(36).substr(2, 4);
            }
            localStorage.setItem('poker_nickname', nickname);
            btn.classList.add('loading');
            
            try {
                multiplayerClient = new MultiplayerClient();
                await multiplayerClient.ensureAuth();
                await multiplayerClient.setNickname(nickname);
                
                await multiplayerClient.joinRoom(roomCode);
                isHost = false;
                showWaitingRoom(roomCode);
            } catch (e) {
                alert('ì…ì¥ ì‹¤íŒ¨: ' + e.message);
            } finally {
                btn.classList.remove('loading');
            }
        }

        function showWaitingRoom(roomCode) {
            document.getElementById('lobby').classList.add('hidden');
            document.getElementById('waitingRoom').classList.remove('hidden');
            document.getElementById('displayRoomCode').textContent = roomCode;
            document.getElementById('startBtn').style.display = isHost ? 'block' : 'none';
            
            // Start listening for updates
            multiplayerClient.onStateChange = updateWaitingRoom;
            multiplayerClient.onEvent = handleMultiplayerEvent;
            multiplayerClient.startListening();
            
            // Initial state load
            refreshWaitingRoom();
        }

        async function refreshWaitingRoom() {
            try {
                const state = await multiplayerClient.getRoomState();
                updateWaitingRoom(state);
            } catch (e) {
                console.error('Failed to refresh:', e);
            }
        }

        function updateWaitingRoom(state) {
            if (!state || !state.players) return;
            
            const playerList = document.getElementById('playerList');
            const myId = multiplayerClient.getMyUserId();
            
            playerList.innerHTML = state.players.map(p => `
                <div class="player-item">
                    <span class="name">${p.isHost ? 'ğŸ‘‘ ' : ''}${p.nickname || 'Player'} ${p.id === myId ? '(ë‚˜)' : ''}</span>
                    <span class="status ${p.isReady ? 'ready' : ''} ${p.isHost ? 'host' : ''}">${p.isHost ? 'ë°©ì¥' : (p.isReady ? 'ì¤€ë¹„ì™„ë£Œ' : 'ëŒ€ê¸°ì¤‘')}</span>
                </div>
            `).join('');
            
            // Update start button visibility
            if (isHost) {
                const allReady = state.players.filter(p => !p.isHost).every(p => p.isReady);
                const canStart = state.players.length >= 2 && allReady;
                document.getElementById('startBtn').disabled = !canStart;
                document.getElementById('waitingMessage').textContent = canStart ? 'ê²Œì„ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!' : 'ë‹¤ë¥¸ í”Œë ˆì´ì–´ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...';
            }
            
            // Check if game started
            if (state.status === 'playing') {
                startMultiplayerGameFromState(state);
            }
        }

        function handleMultiplayerEvent(type, data) {
            console.log('MP Event:', type, data);
            
            if (type === 'game_started') {
                refreshWaitingRoom();
            }
        }

        async function toggleReady() {
            const btn = document.getElementById('readyBtn');
            if (btn.classList.contains('loading')) return;
            btn.classList.add('loading');
            
            try {
                myReady = !myReady;
                await multiplayerClient.setReady(myReady);
                btn.textContent = myReady ? 'ì¤€ë¹„ì·¨ì†Œ' : 'ì¤€ë¹„';
                btn.classList.toggle('primary', myReady);
            } catch (e) {
                myReady = !myReady; // rollback
                alert('ì¤€ë¹„ ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨');
            } finally {
                btn.classList.remove('loading');
            }
        }

        async function startMultiplayerGame() {
            const btn = document.getElementById('startBtn');
            if (btn.classList.contains('loading') || btn.disabled) return;
            btn.classList.add('loading');
            
            try {
                await multiplayerClient.startGame();
                // Game will start via event
            } catch (e) {
                alert('ê²Œì„ ì‹œì‘ ì‹¤íŒ¨: ' + e.message);
                btn.classList.remove('loading');
            }
        }

        function startMultiplayerGameFromState(state) {
            isMultiplayer = true;
            document.getElementById('waitingRoom').classList.add('hidden');
            document.getElementById('gameContainer').style.display = 'block';
            
            // TODO: Update game UI for multiplayer
            // For now, show message
            showMessage('ë©€í‹°í”Œë ˆì´ì–´ ê²Œì„ ì‹œì‘! (êµ¬í˜„ ì¤‘)');
            
            // The full multiplayer game rendering would require more extensive changes
            // to handle multiple players, server-side state, etc.
            console.log('Multiplayer game state:', state);
        }

        async function leaveWaitingRoom() {
            if (multiplayerClient) {
                try {
                    await multiplayerClient.leaveRoom();
                } catch (e) {
                    console.error('Leave error:', e);
                }
                multiplayerClient.stopListening();
                multiplayerClient = null;
            }
            
            isHost = false;
            myReady = false;
            document.getElementById('waitingRoom').classList.add('hidden');
            document.getElementById('modeSelect').classList.remove('hidden');
        }

        function copyRoomCode() {
            const code = document.getElementById('displayRoomCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                showToast('ì½”ë“œ ë³µì‚¬ë¨!');
            }).catch(() => {
                prompt('ì½”ë“œë¥¼ ë³µì‚¬í•˜ì„¸ìš”:', code);
            });
        }

        function shareRoomLink() {
            const code = document.getElementById('displayRoomCode').textContent;
            const url = `${window.location.origin}${window.location.pathname}?room=${code}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'í¬ì»¤ ê²Œì„ ì´ˆëŒ€',
                    text: `í¬ì»¤ ê²Œì„ì— ì°¸ê°€í•˜ì„¸ìš”! ë°© ì½”ë“œ: ${code}`,
                    url: url
                }).catch(() => {});
            } else {
                navigator.clipboard.writeText(url).then(() => {
                    showToast('ë§í¬ ë³µì‚¬ë¨!');
                }).catch(() => {
                    prompt('ë§í¬ë¥¼ ë³µì‚¬í•˜ì„¸ìš”:', url);
                });
            }
        }

        function showToast(msg) {
            const existing = document.querySelector('.toast');
            if (existing) existing.remove();
            
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = msg;
            toast.style.cssText = 'position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:12px 24px;border-radius:8px;z-index:999;animation:fadeIn 0.3s;';
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2000);
        }

        // URL íŒŒë¼ë¯¸í„°ë¡œ ë°© ì½”ë“œê°€ ìˆìœ¼ë©´ ìë™ ì…ì¥
        function checkUrlRoom() {
            const params = new URLSearchParams(window.location.search);
            const roomCode = params.get('room');
            if (roomCode) {
                // Clear URL params
                window.history.replaceState({}, '', window.location.pathname);
                // Show lobby with room code filled
                showLobby();
                document.getElementById('roomCodeInput').value = roomCode;
            }
        }

        // Override newGame for single player
        const originalNewGame = newGame;
        newGame = function() {
            if (isMultiplayer) {
                // TODO: Handle multiplayer new game
                return;
            }
            originalNewGame();
        };

        // ì´ˆê¸°í™” - ëª¨ë“œ ì„ íƒ í™”ë©´ í‘œì‹œ
        // updateDisplay(); // Skip - game container is hidden
        
        // Check for room code in URL
        checkUrlRoom();
    </script>
    <script src="multiplayer.js"></script>
</body>
</html>
