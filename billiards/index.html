<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>3ì¿ ì…˜ ë‹¹êµ¬ ì‹œë®¬ë ˆì´í„° v4.0</title>
<style>
/* ============================================================
   CSS - 3ì¿ ì…˜ ë‹¹êµ¬ ì‹œë®¬ë ˆì´í„° v4.0
   ============================================================ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg: #1a1d2e;
  --panel-bg: rgba(30, 35, 55, 0.85);
  --panel-border: rgba(255,255,255,0.1);
  --accent: #4fc3f7;
  --accent2: #81c784;
  --text: #e0e0e0;
  --text-dim: #888;
  --gold: #ffd700;
  --red: #dc3545;
  --white-ball: #ffffff;
  --table-green: #1a5c26;
  --rail-brown: #5a3a1a;
  --rail-light: #8b6914;
  --glass-bg: rgba(255,255,255,0.06);
  --glass-border: rgba(255,255,255,0.12);
}

html, body {
  width: 100%; height: 100%;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--bg);
  color: var(--text);
  overflow-x: hidden;
}

/* Layout */
#app {
  display: flex;
  width: 100%; min-height: 100vh;
}

/* Left: Table area */
#table-area {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 12px;
  min-width: 0;
}

/* Right: Control panel */
#control-panel {
  width: 320px;
  min-width: 300px;
  max-height: 100vh;
  overflow-y: auto;
  padding: 16px 14px;
  background: var(--panel-bg);
  border-left: 1px solid var(--panel-border);
  display: flex;
  flex-direction: column;
  gap: 12px;
  scrollbar-width: thin;
  scrollbar-color: rgba(255,255,255,0.15) transparent;
}

#control-panel::-webkit-scrollbar { width: 5px; }
#control-panel::-webkit-scrollbar-track { background: transparent; }
#control-panel::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 3px; }

/* Canvas */
#gameCanvas {
  cursor: crosshair;
  border-radius: 4px;
  touch-action: none;
  max-width: 100%;
}

/* Status bar */
#status-bar {
  display: flex;
  gap: 16px;
  padding: 8px 16px;
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: 10px;
  margin-top: 8px;
  flex-wrap: wrap;
  justify-content: center;
  font-size: 14px;
  backdrop-filter: blur(10px);
  width: 100%;
  max-width: 800px;
}

.stat { display: flex; align-items: center; gap: 6px; }
.stat-label { color: var(--text-dim); font-size: 12px; }
.stat-value { font-weight: 700; font-size: 16px; }
.stat-value.cushion { color: var(--accent); }
.stat-value.score { color: var(--gold); }
.stat-value.status-text { color: var(--accent2); font-size: 13px; }

/* Glass card */
.card {
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: 12px;
  padding: 14px;
  backdrop-filter: blur(10px);
}

.card-title {
  font-size: 13px;
  font-weight: 700;
  color: var(--accent);
  margin-bottom: 10px;
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* Sliders */
.slider-group {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.slider-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 13px;
}

.slider-header span:last-child {
  color: var(--accent);
  font-weight: 600;
}

input[type="range"] {
  -webkit-appearance: none;
  appearance: none;
  width: 100%;
  height: 8px;
  border-radius: 4px;
  background: rgba(255,255,255,0.1);
  outline: none;
  cursor: pointer;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 22px; height: 22px;
  border-radius: 50%;
  background: var(--accent);
  cursor: pointer;
  border: 2px solid #fff;
}

input[type="range"]::-moz-range-thumb {
  width: 22px; height: 22px;
  border-radius: 50%;
  background: var(--accent);
  cursor: pointer;
  border: 2px solid #fff;
}

/* Spin diagram */
#spin-diagram {
  width: 100px; height: 100px;
  margin: 0 auto;
  position: relative;
  cursor: pointer;
}

#spin-canvas {
  width: 100px; height: 100px;
  border-radius: 50%;
}

/* Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 10px 16px;
  border: 1px solid var(--glass-border);
  border-radius: 8px;
  background: var(--glass-bg);
  color: var(--text);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
}

.btn:hover { background: rgba(255,255,255,0.12); border-color: var(--accent); }
.btn:active { transform: scale(0.97); }

.btn-primary {
  background: linear-gradient(135deg, #4fc3f7, #29b6f6);
  border-color: #4fc3f7;
  color: #111;
}

.btn-primary:hover { background: linear-gradient(135deg, #81d4fa, #4fc3f7); }

.btn-danger {
  border-color: var(--red);
  color: var(--red);
}

.btn-danger:hover { background: rgba(220,53,69,0.15); }

.btn-row {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.btn-row .btn { flex: 1; min-width: 0; }

/* Preset grid */
.preset-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 6px;
}

.preset-btn {
  padding: 8px 6px;
  font-size: 12px;
  text-align: center;
  border-radius: 6px;
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.08);
  color: var(--text);
  cursor: pointer;
  transition: all 0.2s;
}

.preset-btn:hover {
  background: rgba(79,195,247,0.15);
  border-color: var(--accent);
  color: var(--accent);
}

.preset-btn:active { transform: scale(0.96); }

/* Trajectory toggle */
.toggle-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 13px;
}

.toggle {
  width: 42px; height: 22px;
  background: rgba(255,255,255,0.15);
  border-radius: 11px;
  position: relative;
  cursor: pointer;
  transition: background 0.2s;
}

.toggle.active { background: var(--accent); }

.toggle::after {
  content: '';
  position: absolute;
  width: 18px; height: 18px;
  background: #fff;
  border-radius: 50%;
  top: 2px; left: 2px;
  transition: left 0.2s;
}

.toggle.active::after { left: 22px; }

/* Mobile */
@media (max-width: 900px) {
  #app {
    flex-direction: column;
  }

  #table-area {
    padding: 8px;
  }

  #control-panel {
    width: 100%;
    min-width: 0;
    max-height: none;
    border-left: none;
    border-top: 1px solid var(--panel-border);
    padding: 12px;
    flex-direction: column;
  }

  #status-bar {
    font-size: 12px;
    gap: 10px;
    padding: 6px 10px;
  }

  .preset-grid {
    grid-template-columns: 1fr 1fr 1fr;
  }
}

@media (max-width: 500px) {
  .preset-grid {
    grid-template-columns: 1fr 1fr;
  }
  
  .btn-row { flex-direction: column; }
  .btn-row .btn { flex: auto; }
}

/* Info text */
.info-text {
  font-size: 11px;
  color: var(--text-dim);
  line-height: 1.5;
  text-align: center;
}

/* Version badge */
.version-badge {
  text-align: center;
  font-size: 11px;
  color: var(--text-dim);
  padding: 4px;
}
</style>
</head>
<body>

<div id="app">
  <!-- Left: Table -->
  <div id="table-area">
    <canvas id="gameCanvas"></canvas>
    <div id="status-bar">
      <div class="stat">
        <span class="stat-label">ì¿ ì…˜</span>
        <span class="stat-value cushion" id="cushionCount">0</span>
      </div>
      <div class="stat">
        <span class="stat-label">ì ìˆ˜</span>
        <span class="stat-value score" id="scoreDisplay">0</span>
      </div>
      <div class="stat">
        <span class="stat-label">ìµœê³ </span>
        <span class="stat-value score" id="highScore">0</span>
      </div>
      <div class="stat">
        <span class="stat-value status-text" id="statusText">ì¤€ë¹„</span>
      </div>
    </div>
  </div>

  <!-- Right: Controls -->
  <div id="control-panel">
    <!-- Angle & Power -->
    <div class="card">
      <div class="card-title">âš™ï¸ ì¡°ì‘</div>
      <div class="slider-group">
        <div class="slider-header">
          <span>ê°ë„</span>
          <span id="angleValue">0Â°</span>
        </div>
        <input type="range" id="angleSlider" min="0" max="359" value="0" step="1">
      </div>
      <div class="slider-group" style="margin-top:10px">
        <div class="slider-header">
          <span>íŒŒì›Œ</span>
          <span id="powerValue">100</span>
        </div>
        <input type="range" id="powerSlider" min="1" max="200" value="100" step="1">
      </div>
    </div>

    <!-- Spin -->
    <div class="card">
      <div class="card-title">ğŸ¯ ë‹¹ì  (ìŠ¤í•€)</div>
      <div style="display:flex;align-items:center;gap:16px;justify-content:center">
        <canvas id="spin-canvas" width="100" height="100"></canvas>
        <div style="font-size:12px;color:var(--text-dim);line-height:1.8">
          <div id="spinLabel">ì¤‘ì•™</div>
          <div style="margin-top:4px;font-size:11px">í´ë¦­ìœ¼ë¡œ ì„ íƒ</div>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="card">
      <div class="card-title">ğŸ® ì‹¤í–‰</div>
      <div class="btn-row">
        <button class="btn btn-primary" id="shootBtn" onclick="shoot()">ğŸš€ ë°œì‚¬</button>
        <button class="btn btn-danger" id="resetBtn" onclick="resetGame()">â†º ë¦¬ì…‹</button>
      </div>
      <div class="toggle-row" style="margin-top:10px">
        <span>ê¶¤ì  í‘œì‹œ</span>
        <div class="toggle active" id="trailToggle" onclick="toggleTrail()"></div>
      </div>
      <div class="toggle-row" style="margin-top:6px">
        <span>ê³µ ë°°ì¹˜ ëª¨ë“œ</span>
        <div class="toggle" id="placeToggle" onclick="togglePlaceMode()"></div>
      </div>
    </div>

    <!-- Presets -->
    <div class="card">
      <div class="card-title">ğŸ“š í”„ë¦¬ì…‹ (ìë™ ì‹œì—°)</div>
      <div class="preset-grid" id="presetGrid"></div>
    </div>

    <!-- Info -->
    <div class="info-text">
      ìˆ˜êµ¬(ë…¸ë€ê³µ)ë¥¼ ìº”ë²„ìŠ¤ì—ì„œ ë“œë˜ê·¸í•˜ì—¬ ë°©í–¥ ì„¤ì •<br>
      ë°°ì¹˜ ëª¨ë“œì—ì„œ ê³µì„ ë“œë˜ê·¸í•˜ì—¬ ìœ„ì¹˜ ë³€ê²½
    </div>

    <div class="version-badge">3ì¿ ì…˜ ë‹¹êµ¬ ì‹œë®¬ë ˆì´í„° v4.0</div>
  </div>
</div>

<script>
/* ============================================================
   3ì¿ ì…˜ ë‹¹êµ¬ ì‹œë®¬ë ˆì´í„° v4.0 - JavaScript
   ============================================================ */

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ìƒìˆ˜ & ì„¤ì • â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TABLE_RATIO = 2; // 2:1 (2.84m x 1.42m)
const BALL_DIAMETER_MM = 61.5;
const TABLE_WIDTH_MM = 2840;
const TABLE_HEIGHT_MM = 1420;
const BALL_RADIUS_RATIO = (BALL_DIAMETER_MM / 2) / TABLE_WIDTH_MM;

const FRICTION = 0.993;          // í”„ë ˆì„ë‹¹ ë§ˆì°° ê³„ìˆ˜
const SPIN_FRICTION = 0.985;     // ìŠ¤í•€ ê°ì‡ 
const CUSHION_RESTITUTION = 0.85; // ì¿ ì…˜ ë°˜ë°œ ê³„ìˆ˜
const SPIN_TRANSFER = 0.015;     // ìŠ¤í•€â†’ì†ë„ ì „ë‹¬ë¥ 
const MIN_SPEED = 0.08;          // ì •ì§€ íŒì • ì†ë„

// ìƒ‰ìƒ
const COLORS = {
  cueBall:   '#ffd700',  // ë…¸ë€ê³µ (ìˆ˜êµ¬)
  ball1:     '#ffffff',  // í°ê³µ (1ì êµ¬)
  ball2:     '#dc3545',  // ë¹¨ê°„ê³µ (2ì êµ¬)
  cloth:     '#1a5c26',
  rail:      '#5a3a1a',
  railOuter: '#3e2510',
  railInner: '#7a5a2a',
  diamond:   '#d4af37',
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì „ì—­ ìƒíƒœ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let W, H;                // ìº”ë²„ìŠ¤ í¬ê¸°
let tableX, tableY;      // í…Œì´ë¸” ì¢Œìƒë‹¨ (ìº”ë²„ìŠ¤ ë‚´)
let tableW, tableH;      // í…Œì´ë¸” ë‚´ë¶€ í¬ê¸° (px)
let railSize;            // ë ˆì¼ ë‘ê»˜ (px)
let ballRadius;          // ê³µ ë°˜ì§€ë¦„ (px)

// ê³µ ìƒíƒœ (ìœ„ì¹˜ëŠ” í…Œì´ë¸” ë‚´ë¶€ ì¢Œí‘œ, 0~1 ì •ê·œí™”)
let balls = [];
let score = 0;
let highScore = parseInt(localStorage.getItem('billiards_high') || '0');
let cushionCount = 0;
let hitBalls = new Set();  // ìˆ˜êµ¬ê°€ ë§íŒ ì êµ¬ ì¸ë±ìŠ¤
let isAnimating = false;
let showTrail = true;
let placeMode = false;
let trail = [];            // ìˆ˜êµ¬ ê¶¤ì 
let gameState = 'ready';   // ready, aiming, shooting, done

// ìŠ¤í•€: -1~1 (x: ì¢Œìš°, y: ìƒí•˜)
let spinX = 0, spinY = 0;

// ì¡°ì‘
let angle = 0;
let power = 100;
let isDragging = false;
let dragStart = null;
let placingBall = -1; // ë“œë˜ê·¸ ë°°ì¹˜ ì¤‘ì¸ ê³µ ì¸ë±ìŠ¤

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initBalls() {
  // ê¸°ë³¸ ë°°ì¹˜: ìˆ˜êµ¬ ì¢Œì¸¡, ì êµ¬ë“¤ ìš°ì¸¡
  balls = [
    { x: 0.25, y: 0.5,  vx: 0, vy: 0, spinX: 0, spinY: 0, color: COLORS.cueBall, name: 'ìˆ˜êµ¬' },
    { x: 0.72, y: 0.32, vx: 0, vy: 0, spinX: 0, spinY: 0, color: COLORS.ball1, name: '1ì êµ¬' },
    { x: 0.72, y: 0.68, vx: 0, vy: 0, spinX: 0, spinY: 0, color: COLORS.ball2, name: '2ì êµ¬' },
  ];
}

function resize() {
  const area = document.getElementById('table-area');
  const maxW = area.clientWidth - 24;
  const maxH = area.clientHeight - 80;

  // í…Œì´ë¸” 2:1 ë¹„ìœ¨ì— ë§ì¶”ë˜ ë ˆì¼ ê³µê°„ í™•ë³´
  railSize = Math.max(18, Math.min(maxW, maxH) * 0.03);

  const totalRail = railSize * 2;
  let tw = maxW - totalRail;
  let th = tw / TABLE_RATIO;

  if (th + totalRail > maxH) {
    th = maxH - totalRail;
    tw = th * TABLE_RATIO;
  }

  tableW = Math.floor(tw);
  tableH = Math.floor(th);

  W = tableW + totalRail;
  H = tableH + totalRail;

  canvas.width = W;
  canvas.height = H;
  canvas.style.width = W + 'px';
  canvas.style.height = H + 'px';

  tableX = railSize;
  tableY = railSize;

  ballRadius = tableW * BALL_RADIUS_RATIO;
  if (ballRadius < 6) ballRadius = 6;

  draw();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì¢Œí‘œ ë³€í™˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function normToPixel(nx, ny) {
  return [tableX + nx * tableW, tableY + ny * tableH];
}

function pixelToNorm(px, py) {
  return [(px - tableX) / tableW, (py - tableY) / tableH];
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ê·¸ë¦¬ê¸° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function draw() {
  ctx.clearRect(0, 0, W, H);
  drawTable();
  drawTrail();
  drawBalls();
  if (gameState === 'ready' || gameState === 'aiming') {
    drawGuideline();
  }
}

function drawTable() {
  // ì™¸ê³½ ë ˆì¼ (ì–´ë‘ìš´ ë‚˜ë¬´)
  ctx.fillStyle = COLORS.railOuter;
  ctx.fillRect(0, 0, W, H);

  // ë‚´ê³½ ë ˆì¼ (ë°ì€ ë‚˜ë¬´)
  const ri = railSize * 0.25;
  ctx.fillStyle = COLORS.rail;
  ctx.fillRect(ri, ri, W - ri*2, H - ri*2);

  // ë ˆì¼ í•˜ì´ë¼ì´íŠ¸
  ctx.fillStyle = COLORS.railInner;
  ctx.fillRect(railSize * 0.5, railSize * 0.5, W - railSize, H - railSize);

  // ì¿ ì…˜ (ë ˆì¼ ì•ˆìª½ ê²½ì‚¬ë©´)
  const cushW = railSize * 0.3;
  ctx.fillStyle = '#2d7a3a';
  // ìƒ
  ctx.fillRect(tableX - cushW, tableY - cushW, tableW + cushW*2, cushW);
  // í•˜
  ctx.fillRect(tableX - cushW, tableY + tableH, tableW + cushW*2, cushW);
  // ì¢Œ
  ctx.fillRect(tableX - cushW, tableY, cushW, tableH);
  // ìš°
  ctx.fillRect(tableX + tableW, tableY, cushW, tableH);

  // ë‹¹êµ¬ì²œ
  ctx.fillStyle = COLORS.cloth;
  ctx.fillRect(tableX, tableY, tableW, tableH);

  // ë‹¹êµ¬ì²œ í…ìŠ¤ì²˜ (ë¯¸ì„¸í•œ ë…¸ì´ì¦ˆ)
  ctx.globalAlpha = 0.03;
  for (let i = 0; i < tableW; i += 4) {
    for (let j = 0; j < tableH; j += 4) {
      if (Math.random() > 0.5) {
        ctx.fillStyle = '#000';
        ctx.fillRect(tableX + i, tableY + j, 2, 2);
      }
    }
  }
  ctx.globalAlpha = 1;

  // ì¤‘ì•™ ìŠ¤íŒŸ
  ctx.beginPath();
  ctx.arc(tableX + tableW/2, tableY + tableH/2, 3, 0, Math.PI*2);
  ctx.fillStyle = '#fff';
  ctx.globalAlpha = 0.4;
  ctx.fill();
  ctx.globalAlpha = 1;

  // í—¤ë“œ ìŠ¤íŒŸ (ìˆ˜êµ¬ ê¸°ë³¸ ìœ„ì¹˜)
  ctx.beginPath();
  ctx.arc(tableX + tableW*0.25, tableY + tableH/2, 3, 0, Math.PI*2);
  ctx.fillStyle = '#fff';
  ctx.globalAlpha = 0.3;
  ctx.fill();
  ctx.globalAlpha = 1;

  // í’‹ ìŠ¤íŒŸ
  ctx.beginPath();
  ctx.arc(tableX + tableW*0.75, tableY + tableH/2, 3, 0, Math.PI*2);
  ctx.fillStyle = '#fff';
  ctx.globalAlpha = 0.3;
  ctx.fill();
  ctx.globalAlpha = 1;

  // ë‹¤ì´ì•„ëª¬ë“œ ë§ˆì»¤
  drawDiamonds();
}

function drawDiamonds() {
  const dSize = Math.max(4, railSize * 0.18);
  ctx.fillStyle = COLORS.diamond;

  // ê¸´ ìª½ (ìƒ/í•˜): ê° 7ê°œ ë‹¤ì´ì•„ëª¬ë“œ (í…Œì´ë¸”ì„ 8ë“±ë¶„)
  for (let i = 1; i <= 7; i++) {
    const x = tableX + (tableW * i / 8);
    // ìƒë‹¨ ë ˆì¼
    drawDiamond(x, tableY - railSize * 0.5, dSize);
    // í•˜ë‹¨ ë ˆì¼
    drawDiamond(x, tableY + tableH + railSize * 0.5, dSize);
  }

  // ì§§ì€ ìª½ (ì¢Œ/ìš°): ê° 3ê°œ ë‹¤ì´ì•„ëª¬ë“œ (í…Œì´ë¸”ì„ 4ë“±ë¶„)
  for (let i = 1; i <= 3; i++) {
    const y = tableY + (tableH * i / 4);
    // ì¢Œì¸¡ ë ˆì¼
    drawDiamond(tableX - railSize * 0.5, y, dSize);
    // ìš°ì¸¡ ë ˆì¼
    drawDiamond(tableX + tableW + railSize * 0.5, y, dSize);
  }
}

function drawDiamond(cx, cy, size) {
  ctx.beginPath();
  ctx.moveTo(cx, cy - size);
  ctx.lineTo(cx + size * 0.7, cy);
  ctx.lineTo(cx, cy + size);
  ctx.lineTo(cx - size * 0.7, cy);
  ctx.closePath();
  ctx.fill();
}

function drawBalls() {
  balls.forEach((ball, i) => {
    const [px, py] = normToPixel(ball.x, ball.y);

    // ê·¸ë¦¼ì
    ctx.beginPath();
    ctx.arc(px + 2, py + 2, ballRadius, 0, Math.PI * 2);
    ctx.fillStyle = 'rgba(0,0,0,0.3)';
    ctx.fill();

    // ê³µ ë³¸ì²´
    ctx.beginPath();
    ctx.arc(px, py, ballRadius, 0, Math.PI * 2);

    // ê·¸ë¼ë””ì–¸íŠ¸
    const grad = ctx.createRadialGradient(px - ballRadius*0.3, py - ballRadius*0.3, ballRadius*0.1, px, py, ballRadius);
    if (i === 0) { // ë…¸ë€ê³µ
      grad.addColorStop(0, '#fff8c4');
      grad.addColorStop(0.5, ball.color);
      grad.addColorStop(1, '#b8960f');
    } else if (i === 1) { // í°ê³µ
      grad.addColorStop(0, '#ffffff');
      grad.addColorStop(0.5, '#f0f0f0');
      grad.addColorStop(1, '#c0c0c0');
    } else { // ë¹¨ê°„ê³µ
      grad.addColorStop(0, '#ff6b7a');
      grad.addColorStop(0.5, ball.color);
      grad.addColorStop(1, '#8b1a25');
    }
    ctx.fillStyle = grad;
    ctx.fill();

    // í…Œë‘ë¦¬
    ctx.strokeStyle = 'rgba(0,0,0,0.3)';
    ctx.lineWidth = 1;
    ctx.stroke();

    // í•˜ì´ë¼ì´íŠ¸
    ctx.beginPath();
    ctx.arc(px - ballRadius * 0.25, py - ballRadius * 0.25, ballRadius * 0.25, 0, Math.PI * 2);
    ctx.fillStyle = 'rgba(255,255,255,0.5)';
    ctx.fill();
  });
}

function drawGuideline() {
  if (isAnimating) return;
  const cue = balls[0];
  const [cx, cy] = normToPixel(cue.x, cue.y);
  const rad = angle * Math.PI / 180;
  const len = 60 + power * 0.8;

  ctx.setLineDash([6, 4]);
  ctx.strokeStyle = 'rgba(255,255,255,0.5)';
  ctx.lineWidth = 1.5;
  ctx.beginPath();
  ctx.moveTo(cx, cy);
  ctx.lineTo(cx + Math.cos(rad) * len, cy + Math.sin(rad) * len);
  ctx.stroke();
  ctx.setLineDash([]);

  // í ìŠ¤í‹± (ë°˜ëŒ€ ë°©í–¥)
  ctx.strokeStyle = '#c4a35a';
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.moveTo(cx - Math.cos(rad) * (ballRadius + 4), cy - Math.sin(rad) * (ballRadius + 4));
  ctx.lineTo(cx - Math.cos(rad) * (ballRadius + 80 + power * 0.3), cy - Math.sin(rad) * (ballRadius + 80 + power * 0.3));
  ctx.stroke();

  // í íŒ
  ctx.strokeStyle = '#87ceeb';
  ctx.lineWidth = 4;
  ctx.beginPath();
  ctx.moveTo(cx - Math.cos(rad) * (ballRadius + 2), cy - Math.sin(rad) * (ballRadius + 2));
  ctx.lineTo(cx - Math.cos(rad) * (ballRadius + 8), cy - Math.sin(rad) * (ballRadius + 8));
  ctx.stroke();
}

function drawTrail() {
  if (!showTrail || trail.length < 2) return;
  ctx.setLineDash([3, 3]);
  ctx.strokeStyle = 'rgba(255,215,0,0.35)';
  ctx.lineWidth = 1.5;
  ctx.beginPath();
  const [sx, sy] = normToPixel(trail[0].x, trail[0].y);
  ctx.moveTo(sx, sy);
  for (let i = 1; i < trail.length; i++) {
    const [px, py] = normToPixel(trail[i].x, trail[i].y);
    ctx.lineTo(px, py);
  }
  ctx.stroke();
  ctx.setLineDash([]);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ìŠ¤í•€ ë‹¤ì´ì–´ê·¸ë¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const spinCanvas = document.getElementById('spin-canvas');
const spinCtx = spinCanvas.getContext('2d');

function drawSpinDiagram() {
  const w = 100, h = 100, r = 42;
  spinCtx.clearRect(0, 0, w, h);

  // ê³µ ì™¸ê³½
  spinCtx.beginPath();
  spinCtx.arc(50, 50, r, 0, Math.PI * 2);
  const grad = spinCtx.createRadialGradient(42, 42, 5, 50, 50, r);
  grad.addColorStop(0, '#fff8c4');
  grad.addColorStop(0.6, '#ffd700');
  grad.addColorStop(1, '#b8960f');
  spinCtx.fillStyle = grad;
  spinCtx.fill();
  spinCtx.strokeStyle = 'rgba(0,0,0,0.3)';
  spinCtx.lineWidth = 1;
  spinCtx.stroke();

  // 9ê°œ ë‹¹ì  ê·¸ë¦¬ë“œ
  for (let sy = -1; sy <= 1; sy++) {
    for (let sx = -1; sx <= 1; sx++) {
      const px = 50 + sx * 22;
      const py = 50 + sy * 22;
      const isSelected = (sx === spinX && sy === spinY);

      spinCtx.beginPath();
      spinCtx.arc(px, py, isSelected ? 7 : 4, 0, Math.PI * 2);
      spinCtx.fillStyle = isSelected ? '#ff4444' : 'rgba(0,0,0,0.3)';
      spinCtx.fill();
      if (isSelected) {
        spinCtx.strokeStyle = '#fff';
        spinCtx.lineWidth = 2;
        spinCtx.stroke();
      }
    }
  }

  // ë¼ë²¨ ì—…ë°ì´íŠ¸
  const yLabels = ['ìƒë‹¨', 'ì¤‘ì•™', 'í•˜ë‹¨'];
  const xLabels = ['ì¢Œ', '', 'ìš°'];
  const yL = yLabels[spinY + 1];
  const xL = xLabels[spinX + 1];
  let label = yL + (xL ? ' ' + xL : '');
  if (spinX === 0 && spinY === 0) label = 'ì¤‘ì•™ (ë¬´íšŒì „)';
  document.getElementById('spinLabel').textContent = label;
}

spinCanvas.addEventListener('click', (e) => {
  const rect = spinCanvas.getBoundingClientRect();
  const x = (e.clientX - rect.left) / rect.width * 100;
  const y = (e.clientY - rect.top) / rect.height * 100;

  // ì–´ëŠ ë‹¹ì ì— ê°€ì¥ ê°€ê¹Œìš´ì§€
  let bestDist = Infinity;
  let bsx = 0, bsy = 0;
  for (let sy = -1; sy <= 1; sy++) {
    for (let sx = -1; sx <= 1; sx++) {
      const px = 50 + sx * 22;
      const py = 50 + sy * 22;
      const d = Math.hypot(x - px, y - py);
      if (d < bestDist) {
        bestDist = d;
        bsx = sx;
        bsy = sy;
      }
    }
  }
  spinX = bsx;
  spinY = bsy;
  drawSpinDiagram();
});

spinCanvas.addEventListener('touchstart', (e) => {
  e.preventDefault();
  const touch = e.touches[0];
  const rect = spinCanvas.getBoundingClientRect();
  const x = (touch.clientX - rect.left) / rect.width * 100;
  const y = (touch.clientY - rect.top) / rect.height * 100;
  let bestDist = Infinity, bsx = 0, bsy = 0;
  for (let sy = -1; sy <= 1; sy++) {
    for (let sx = -1; sx <= 1; sx++) {
      const px = 50 + sx * 22, py = 50 + sy * 22;
      const d = Math.hypot(x - px, y - py);
      if (d < bestDist) { bestDist = d; bsx = sx; bsy = sy; }
    }
  }
  spinX = bsx; spinY = bsy;
  drawSpinDiagram();
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë¬¼ë¦¬ì—”ì§„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function shoot() {
  if (isAnimating) return;

  const rad = angle * Math.PI / 180;
  const speed = power * 0.00045;

  const cue = balls[0];
  cue.vx = Math.cos(rad) * speed;
  cue.vy = Math.sin(rad) * speed;

  // ìŠ¤í•€ ì ìš©
  cue.spinX = spinX * 0.4;  // ì¢Œìš° ì‚¬ì´ë“œìŠ¤í•€
  cue.spinY = spinY * 0.4;  // ìƒí•˜ í†±/ë°±ìŠ¤í•€

  // ì´ˆê¸°í™”
  cushionCount = 0;
  hitBalls = new Set();
  trail = [{ x: cue.x, y: cue.y }];
  gameState = 'shooting';
  isAnimating = true;

  updateStatus('ë°œì‚¬!');
  updateCushionDisplay();
  requestAnimationFrame(gameLoop);
}

function gameLoop() {
  if (!isAnimating) return;

  // ë¬¼ë¦¬ ì‹œë®¬ë ˆì´ì…˜ (ì„œë¸ŒìŠ¤í…)
  const subSteps = 3;
  for (let s = 0; s < subSteps; s++) {
    updatePhysics();
  }

  // ê¶¤ì  ê¸°ë¡ (ë§¤ 3í”„ë ˆì„)
  if (showTrail && trail.length < 5000) {
    const cue = balls[0];
    const last = trail[trail.length - 1];
    if (!last || Math.hypot(cue.x - last.x, cue.y - last.y) > 0.003) {
      trail.push({ x: cue.x, y: cue.y });
    }
  }

  draw();

  // ì •ì§€ íŒì •
  const moving = balls.some(b => Math.hypot(b.vx, b.vy) > MIN_SPEED * 0.00045);
  if (!moving) {
    isAnimating = false;
    gameState = 'done';
    checkScore();
    return;
  }

  requestAnimationFrame(gameLoop);
}

function updatePhysics() {
  // ì •ê·œí™”ëœ ê³µ ë°˜ì§€ë¦„ (xì¶•, yì¶• ê°ê°)
  const brX = ballRadius / tableW;
  const brY = ballRadius / tableH;

  balls.forEach((ball, i) => {
    if (Math.abs(ball.vx) < 1e-7 && Math.abs(ball.vy) < 1e-7) return;

    // ìŠ¤í•€â†’ì†ë„ ì „ë‹¬ (ë§ˆì°°ì„ í†µí•´, ìˆ˜êµ¬ë§Œ)
    if (i === 0) {
      ball.vx += ball.spinX * SPIN_TRANSFER * 0.001;
      ball.vy += ball.spinY * SPIN_TRANSFER * 0.001;
      ball.spinX *= SPIN_FRICTION;
      ball.spinY *= SPIN_FRICTION;
      if (Math.abs(ball.spinX) < 0.001) ball.spinX = 0;
      if (Math.abs(ball.spinY) < 0.001) ball.spinY = 0;
    }

    // ì´ë™
    ball.x += ball.vx;
    ball.y += ball.vy;

    // ë§ˆì°°
    ball.vx *= FRICTION;
    ball.vy *= FRICTION;

    // ì¿ ì…˜ ì¶©ëŒ (xì¶•: 0~1, yì¶•: 0~1, ë°˜ì§€ë¦„ì€ ê° ì¶•ì— ë§ê²Œ)
    // ì¢Œì¸¡ ì¿ ì…˜
    if (ball.x < brX) {
      ball.x = brX;
      ball.vx = Math.abs(ball.vx) * CUSHION_RESTITUTION;
      if (i === 0) {
        ball.vy += ball.spinX * 0.003;   // ì‰ê¸€ë¦¬ì‹œ
        ball.vx += ball.spinY * 0.001;   // í†±/ë°±ìŠ¤í•€
        registerCushion();
      }
    }
    // ìš°ì¸¡ ì¿ ì…˜
    if (ball.x > 1 - brX) {
      ball.x = 1 - brX;
      ball.vx = -Math.abs(ball.vx) * CUSHION_RESTITUTION;
      if (i === 0) {
        ball.vy -= ball.spinX * 0.003;
        ball.vx -= ball.spinY * 0.001;
        registerCushion();
      }
    }
    // ìƒë‹¨ ì¿ ì…˜
    if (ball.y < brY) {
      ball.y = brY;
      ball.vy = Math.abs(ball.vy) * CUSHION_RESTITUTION;
      if (i === 0) {
        ball.vx += ball.spinX * 0.003;
        ball.vy += ball.spinY * 0.001;
        registerCushion();
      }
    }
    // í•˜ë‹¨ ì¿ ì…˜
    if (ball.y > 1 - brY) {
      ball.y = 1 - brY;
      ball.vy = -Math.abs(ball.vy) * CUSHION_RESTITUTION;
      if (i === 0) {
        ball.vx -= ball.spinX * 0.003;
        ball.vy -= ball.spinY * 0.001;
        registerCushion();
      }
    }
  });

  // ê³µ-ê³µ ì¶©ëŒ (í”½ì…€ ê³µê°„ì—ì„œ ê±°ë¦¬ ê³„ì‚°)
  for (let i = 0; i < balls.length; i++) {
    for (let j = i + 1; j < balls.length; j++) {
      // ì •ê·œí™” ì¢Œí‘œë¥¼ í”½ì…€ë¡œ ë³€í™˜í•˜ì—¬ ê±°ë¦¬ ê³„ì‚°
      const pxI = balls[i].x * tableW;
      const pyI = balls[i].y * tableH;
      const pxJ = balls[j].x * tableW;
      const pyJ = balls[j].y * tableH;

      const dx = pxJ - pxI;
      const dy = pyJ - pyI;
      const dist = Math.hypot(dx, dy);
      const minDist = ballRadius * 2;

      if (dist < minDist && dist > 0.01) {
        // ì¶©ëŒ ë²•ì„  ë²¡í„° (í”½ì…€ ê³µê°„)
        const nx = dx / dist;
        const ny = dy / dist;

        // ê²¹ì¹¨ í•´ì†Œ (ì •ê·œí™” ì¢Œí‘œë¡œ ë³€í™˜)
        const overlap = (minDist - dist) * 0.5;
        balls[i].x -= (nx * overlap) / tableW;
        balls[i].y -= (ny * overlap) / tableH;
        balls[j].x += (nx * overlap) / tableW;
        balls[j].y += (ny * overlap) / tableH;

        // ì†ë„ë¥¼ í”½ì…€/í”„ë ˆì„ ë‹¨ìœ„ë¡œ ë³€í™˜
        const vix = balls[i].vx * tableW;
        const viy = balls[i].vy * tableH;
        const vjx = balls[j].vx * tableW;
        const vjy = balls[j].vy * tableH;

        // ë²•ì„  ë°©í–¥ ìƒëŒ€ ì†ë„
        const relVn = (vix - vjx) * nx + (viy - vjy) * ny;

        if (relVn > 0) {
          // ë™ì¼ ì§ˆëŸ‰ íƒ„ì„± ì¶©ëŒ: ë²•ì„  ë°©í–¥ ì†ë„ êµí™˜
          const impX = nx * relVn;
          const impY = ny * relVn;

          balls[i].vx -= impX / tableW;
          balls[i].vy -= impY / tableH;
          balls[j].vx += impX / tableW;
          balls[j].vy += impY / tableH;

          // ìˆ˜êµ¬ ì¶©ëŒ ë“±ë¡
          if (i === 0) {
            hitBalls.add(j);
            balls[i].spinX *= 0.5;
            balls[i].spinY *= 0.5;
          }
          if (j === 0) {
            hitBalls.add(i);
            balls[j].spinX *= 0.5;
            balls[j].spinY *= 0.5;
          }
        }
      }
    }
  }
}

function registerCushion() {
  cushionCount++;
  updateCushionDisplay();
}

function updateCushionDisplay() {
  document.getElementById('cushionCount').textContent = cushionCount;
}

function checkScore() {
  if (cushionCount >= 3 && hitBalls.size >= 2) {
    score++;
    updateStatus('âœ… ë“ì ! (+1)');
    if (score > highScore) {
      highScore = score;
      localStorage.setItem('billiards_high', highScore.toString());
    }
  } else {
    if (hitBalls.size < 2) {
      updateStatus('âŒ ì êµ¬ 2ê°œ ë¯¸ë§í˜');
    } else {
      updateStatus(`âŒ ì¿ ì…˜ ë¶€ì¡± (${cushionCount}/3)`);
    }
  }
  document.getElementById('scoreDisplay').textContent = score;
  document.getElementById('highScore').textContent = highScore;
  gameState = 'ready';
}

function updateStatus(text) {
  document.getElementById('statusText').textContent = text;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì»¨íŠ¸ë¡¤ ì´ë²¤íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const angleSlider = document.getElementById('angleSlider');
const powerSlider = document.getElementById('powerSlider');

angleSlider.addEventListener('input', () => {
  angle = parseInt(angleSlider.value);
  document.getElementById('angleValue').textContent = angle + 'Â°';
  if (!isAnimating) draw();
});

powerSlider.addEventListener('input', () => {
  power = parseInt(powerSlider.value);
  document.getElementById('powerValue').textContent = power;
  if (!isAnimating) draw();
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ìº”ë²„ìŠ¤ ì¸í„°ë™ì…˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getEventPos(e) {
  const rect = canvas.getBoundingClientRect();
  const scaleX = canvas.width / rect.width;
  const scaleY = canvas.height / rect.height;
  if (e.touches) {
    return {
      x: (e.touches[0].clientX - rect.left) * scaleX,
      y: (e.touches[0].clientY - rect.top) * scaleY,
    };
  }
  return {
    x: (e.clientX - rect.left) * scaleX,
    y: (e.clientY - rect.top) * scaleY,
  };
}

function findBallAt(px, py) {
  for (let i = 0; i < balls.length; i++) {
    const [bx, by] = normToPixel(balls[i].x, balls[i].y);
    if (Math.hypot(px - bx, py - by) < ballRadius + 8) return i;
  }
  return -1;
}

canvas.addEventListener('mousedown', onPointerDown);
canvas.addEventListener('touchstart', (e) => { e.preventDefault(); onPointerDown(e); }, { passive: false });

canvas.addEventListener('mousemove', onPointerMove);
canvas.addEventListener('touchmove', (e) => { e.preventDefault(); onPointerMove(e); }, { passive: false });

canvas.addEventListener('mouseup', onPointerUp);
canvas.addEventListener('touchend', (e) => { onPointerUp(e); });

function onPointerDown(e) {
  if (isAnimating) return;
  const pos = getEventPos(e);
  const hitIdx = findBallAt(pos.x, pos.y);

  if (placeMode && hitIdx >= 0) {
    placingBall = hitIdx;
    return;
  }

  if (hitIdx === 0) {
    // ìˆ˜êµ¬ ë“œë˜ê·¸ â†’ ë°©í–¥ ì„¤ì •
    isDragging = true;
    dragStart = pos;
    gameState = 'aiming';
  }
}

function onPointerMove(e) {
  if (isAnimating) return;
  const pos = getEventPos(e);

  if (placeMode && placingBall >= 0) {
    const [nx, ny] = pixelToNorm(pos.x, pos.y);
    const br = ballRadius / tableW;
    const brY = ballRadius / tableH;
    balls[placingBall].x = Math.max(br, Math.min(1 - br, nx));
    balls[placingBall].y = Math.max(brY, Math.min(1 - brY, ny));
    draw();
    return;
  }

  if (isDragging && dragStart) {
    const [cx, cy] = normToPixel(balls[0].x, balls[0].y);
    // ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ë°œì‚¬
    const dx = dragStart.x - pos.x;
    const dy = dragStart.y - pos.y;
    if (Math.hypot(dx, dy) > 5) {
      angle = Math.round(Math.atan2(dy, dx) * 180 / Math.PI);
      if (angle < 0) angle += 360;
      angleSlider.value = angle;
      document.getElementById('angleValue').textContent = angle + 'Â°';

      // ë“œë˜ê·¸ ê±°ë¦¬ë¡œ íŒŒì›Œ ì¡°ì ˆ
      const dragDist = Math.hypot(dx, dy);
      power = Math.min(200, Math.max(1, Math.round(dragDist * 0.8)));
      powerSlider.value = power;
      document.getElementById('powerValue').textContent = power;
    }
    draw();
  }
}

function onPointerUp(e) {
  if (placeMode && placingBall >= 0) {
    placingBall = -1;
    return;
  }

  if (isDragging) {
    isDragging = false;
    const endPos = e.changedTouches ? {
      x: (e.changedTouches[0].clientX - canvas.getBoundingClientRect().left) * (canvas.width / canvas.getBoundingClientRect().width),
      y: (e.changedTouches[0].clientY - canvas.getBoundingClientRect().top) * (canvas.height / canvas.getBoundingClientRect().height),
    } : getEventPos(e);

    if (dragStart && Math.hypot(endPos.x - dragStart.x, endPos.y - dragStart.y) > 15) {
      shoot();
    }
    dragStart = null;
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í† ê¸€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleTrail() {
  showTrail = !showTrail;
  document.getElementById('trailToggle').classList.toggle('active', showTrail);
  if (!isAnimating) draw();
}

function togglePlaceMode() {
  placeMode = !placeMode;
  document.getElementById('placeToggle').classList.toggle('active', placeMode);
  canvas.style.cursor = placeMode ? 'grab' : 'crosshair';
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë¦¬ì…‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function resetGame() {
  isAnimating = false;
  score = 0;
  cushionCount = 0;
  hitBalls = new Set();
  trail = [];
  gameState = 'ready';
  initBalls();
  updateStatus('ì¤€ë¹„');
  document.getElementById('scoreDisplay').textContent = '0';
  document.getElementById('cushionCount').textContent = '0';
  draw();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ í”„ë¦¬ì…‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const presets = [
  {
    name: 'ì•ëŒë¦¬ê¸°',
    desc: 'ê¸°ë³¸ 3ì¿ ì…˜',
    balls: [
      { x: 0.20, y: 0.70 },
      { x: 0.20, y: 0.25 },
      { x: 0.75, y: 0.25 },
    ],
    angle: 350,
    power: 120,
    spinX: 1,
    spinY: 0,
  },
  {
    name: 'ë’¤ëŒë¦¬ê¸°',
    desc: 'ë’¤ë¡œ ëŒì•„ì„œ',
    balls: [
      { x: 0.25, y: 0.50 },
      { x: 0.50, y: 0.25 },
      { x: 0.80, y: 0.75 },
    ],
    angle: 200,
    power: 130,
    spinX: -1,
    spinY: 0,
  },
  {
    name: 'ì˜†ëŒë¦¬ê¸°',
    desc: 'ì‚¬ì´ë“œ ê¸°ìˆ ',
    balls: [
      { x: 0.25, y: 0.50 },
      { x: 0.50, y: 0.15 },
      { x: 0.75, y: 0.50 },
    ],
    angle: 330,
    power: 110,
    spinX: 1,
    spinY: -1,
  },
  {
    name: 'ë¹„ê»´ì¹˜ê¸°',
    desc: 'ì–‡ê²Œ ìŠ¤ì¹˜ê³ ',
    balls: [
      { x: 0.30, y: 0.50 },
      { x: 0.42, y: 0.45 },
      { x: 0.75, y: 0.75 },
    ],
    angle: 15,
    power: 105,
    spinX: 1,
    spinY: 0,
  },
  {
    name: 'ëŒì–´ì¹˜ê¸°',
    desc: 'ë“œë¡œìš° ë°±ìŠ¤í•€',
    balls: [
      { x: 0.30, y: 0.50 },
      { x: 0.55, y: 0.50 },
      { x: 0.80, y: 0.25 },
    ],
    angle: 0,
    power: 95,
    spinX: 0,
    spinY: 1,
  },
  {
    name: 'ë°€ì–´ì¹˜ê¸°',
    desc: 'íŒ”ë¡œìš° í†±ìŠ¤í•€',
    balls: [
      { x: 0.30, y: 0.50 },
      { x: 0.55, y: 0.50 },
      { x: 0.80, y: 0.75 },
    ],
    angle: 0,
    power: 100,
    spinX: 0,
    spinY: -1,
  },
  {
    name: 'ëŒ€íšŒì „',
    desc: 'ë¹…ë³¼ í’€í…Œì´ë¸”',
    balls: [
      { x: 0.15, y: 0.75 },
      { x: 0.15, y: 0.25 },
      { x: 0.85, y: 0.50 },
    ],
    angle: 340,
    power: 160,
    spinX: 1,
    spinY: -1,
  },
  {
    name: 'ë”ë¸”ì¿ ì…˜',
    desc: 'ê°™ì€ ì¿ ì…˜ 2ë²ˆ',
    balls: [
      { x: 0.20, y: 0.80 },
      { x: 0.20, y: 0.20 },
      { x: 0.60, y: 0.50 },
    ],
    angle: 310,
    power: 125,
    spinX: 1,
    spinY: 0,
  },
  {
    name: 'ì”ì¿ ì…˜',
    desc: 'ì§§ì€ ì •êµí•œ ìƒ·',
    balls: [
      { x: 0.40, y: 0.55 },
      { x: 0.55, y: 0.40 },
      { x: 0.65, y: 0.60 },
    ],
    angle: 300,
    power: 70,
    spinX: -1,
    spinY: 0,
  },
  {
    name: 'ë±…í¬ìƒ·',
    desc: 'ì§ì ‘ ì¿ ì…˜ ê²½ìœ ',
    balls: [
      { x: 0.15, y: 0.50 },
      { x: 0.85, y: 0.30 },
      { x: 0.85, y: 0.70 },
    ],
    angle: 20,
    power: 145,
    spinX: 0,
    spinY: 0,
  },
  {
    name: 'í‚¤ìŠ¤ìƒ·',
    desc: 'ì êµ¬ í™œìš©',
    balls: [
      { x: 0.25, y: 0.50 },
      { x: 0.50, y: 0.50 },
      { x: 0.75, y: 0.30 },
    ],
    angle: 5,
    power: 100,
    spinX: 0,
    spinY: -1,
  },
  {
    name: 'ì„¸ì´í”„í‹°',
    desc: 'ë°©ì–´ ë°°ì¹˜',
    balls: [
      { x: 0.25, y: 0.50 },
      { x: 0.60, y: 0.20 },
      { x: 0.80, y: 0.80 },
    ],
    angle: 345,
    power: 60,
    spinX: -1,
    spinY: 1,
  },
];

function loadPreset(idx) {
  if (isAnimating) return;
  const p = presets[idx];
  
  // ê³µ ë°°ì¹˜
  balls = [
    { x: p.balls[0].x, y: p.balls[0].y, vx: 0, vy: 0, spinX: 0, spinY: 0, color: COLORS.cueBall, name: 'ìˆ˜êµ¬' },
    { x: p.balls[1].x, y: p.balls[1].y, vx: 0, vy: 0, spinX: 0, spinY: 0, color: COLORS.ball1, name: '1ì êµ¬' },
    { x: p.balls[2].x, y: p.balls[2].y, vx: 0, vy: 0, spinX: 0, spinY: 0, color: COLORS.ball2, name: '2ì êµ¬' },
  ];

  // ì„¤ì •
  angle = p.angle;
  power = p.power;
  spinX = p.spinX;
  spinY = p.spinY;

  angleSlider.value = angle;
  powerSlider.value = power;
  document.getElementById('angleValue').textContent = angle + 'Â°';
  document.getElementById('powerValue').textContent = power;

  trail = [];
  cushionCount = 0;
  hitBalls = new Set();
  gameState = 'ready';
  updateCushionDisplay();

  drawSpinDiagram();
  draw();

  // ìë™ ë°œì‚¬ (500ms í›„)
  updateStatus(`í”„ë¦¬ì…‹: ${p.name}`);
  setTimeout(() => shoot(), 500);
}

function buildPresetGrid() {
  const grid = document.getElementById('presetGrid');
  presets.forEach((p, i) => {
    const btn = document.createElement('button');
    btn.className = 'preset-btn';
    btn.textContent = p.name;
    btn.title = p.desc;
    btn.onclick = () => loadPreset(i);
    grid.appendChild(btn);
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì´ˆê¸°í™” ì‹¤í–‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function init() {
  initBalls();
  buildPresetGrid();
  drawSpinDiagram();
  document.getElementById('highScore').textContent = highScore;
  resize();
}

window.addEventListener('resize', resize);
window.addEventListener('load', init);
</script>
</body>
</html>
